var go=Object.defineProperty;var vo=(d,a,t)=>a in d?go(d,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[a]=t;var oe=(d,a,t)=>vo(d,typeof a!="symbol"?a+"":a,t);import{i as Ws,c as yo,r as o,s as Zs,u as ht,j as e}from"./vendor-Cpb81dVA.js";import{D as Io}from"./vendor-dexie-BWsXn92a.js";import{B as os}from"./vendor-zxing-6Q_caI5h.js";class xo extends Io{constructor(){super("meddx_survey");oe(this,"survey_drafts");oe(this,"survey_photos");oe(this,"survey_masters");oe(this,"indices");oe(this,"settings");oe(this,"location_buildings");oe(this,"location_floors");oe(this,"location_departments");oe(this,"location_divisions");oe(this,"product_categories");oe(this,"product_subcategories");oe(this,"product_items");oe(this,"product_makers");oe(this,"product_models");oe(this,"location_rooms");this.version(1).stores({survey_drafts:"id,updatedAt,qr",survey_photos:"id,draftId,createdAt",survey_masters:"id,updatedAt,nameNfkc,makerNfkc,model",indices:"id",settings:"key"}),this.version(2).stores({survey_drafts:"id,updatedAt,qr",survey_photos:"id,draftId,createdAt",survey_masters:"id,updatedAt,nameNfkc,makerNfkc,model",indices:"id",settings:"key",location_buildings:"id,name",location_floors:"id,buildingId,name",location_departments:"id,buildingId,floorId,name",location_divisions:"id,buildingId,floorId,departmentId,name",product_categories:"id,name",product_subcategories:"id,categoryId,name",product_items:"id,categoryId,subcategoryId,name",product_makers:"id,categoryId,subcategoryId,itemId,name",product_models:"id,categoryId,subcategoryId,itemId,makerId,name"}),this.version(3).stores({survey_drafts:"id,updatedAt,qr",survey_photos:"id,draftId,createdAt",survey_masters:"id,updatedAt,nameNfkc,makerNfkc,model",indices:"id",settings:"key",location_buildings:"id,name",location_floors:"id,buildingId,name",location_departments:"id,buildingId,floorId,name",location_divisions:"id,buildingId,floorId,departmentId,name",product_categories:"id,name",product_subcategories:"id,categoryId,name",product_items:"id,categoryId,subcategoryId,name",product_makers:"id,categoryId,subcategoryId,itemId,name",product_models:"id,categoryId,subcategoryId,itemId,makerId,name",location_rooms:"id,buildingId,floorId,departmentId,divisionId,name"})}}const w=new xo,jo="/poc-survey-offline-mock/".replace(/\/?$/,"/"),zs=`${jo}vendor/browser-image-compression.js`;async function bo(d,a=2560){const f=await Ws(d,{maxWidthOrHeight:a,initialQuality:.7,fileType:"image/webp",useWebWorker:!0,libURL:zs}),N=await Ws(d,{maxWidthOrHeight:512,initialQuality:.7,fileType:"image/webp",useWebWorker:!0,libURL:zs});return{blob:f,thumb:N}}const qe=yo((d,a)=>{const t=async()=>{const n=a().current;if(!n){d({photos:[]});return}const l=await w.survey_photos.where("draftId").equals(n.id).reverse().toArray();d({photos:l})},f=async()=>{const n=await w.survey_drafts.filter(l=>{var m;return((m=l.fields)==null?void 0:m.status)==="completed"}).count();d({completedCount:n})},N=async n=>{await w.survey_drafts.put(n),d({current:n}),await f()},y={current:void 0,photos:[],completedCount:0,async newDraft(){const n=crypto.randomUUID(),l={id:n,fields:{},photoIds:[],updatedAt:Date.now()};return await w.survey_drafts.put(l),d({current:l}),setTimeout(()=>{t()},0),await f(),n},async load(n){let l=await w.survey_drafts.get(n);l||(l={id:n,fields:{},photoIds:[],updatedAt:Date.now()},await w.survey_drafts.put(l)),d({current:l}),await t(),await f()},async setField(n,l){const m=a().current;if(!m)return;const h={...m.fields};l==null||l===""?delete h[n]:h[n]=l;const j={...m,fields:h,updatedAt:Date.now()};await N(j)},async setFields(n){const l=a().current;if(!l)return;const m={...l.fields};Object.entries(n).forEach(([j,I])=>{I==null||I===""?delete m[j]:m[j]=I});const h={...l,fields:m,updatedAt:Date.now()};await N(h)},async setQR(n){const l=a().current;if(!l)return;const m={...l,qr:n,fields:{...l.fields,sealNo:n,qrCode:n},updatedAt:Date.now()};await N(m)},async attachPhoto(n){const l=a().current;if(!l)return;const{blob:m,thumb:h}=await bo(n),j={id:crypto.randomUUID(),draftId:l.id,blob:m,thumb:h,size:m.size,createdAt:Date.now()};await w.survey_photos.put(j);const I={...l,photoIds:[...l.photoIds,j.id],updatedAt:Date.now()};await N(I),await t()},async removePhoto(n){const l=a().current;if(!l)return;await w.survey_photos.delete(n);const m=l.photoIds.filter(j=>j!==n),h={...l,photoIds:m,updatedAt:Date.now()};await N(h),await t()},async refreshPhotos(){await t()},async refreshStats(){await f()},async completeCurrent(n){const l=a().current;if(!l)return;const m={...l,fields:{...l.fields,status:"completed",completedAt:Date.now()},updatedAt:Date.now()};await N(m),await t();const h=await a().newDraft();await t();const j=(n==null?void 0:n.preserveKeys)??[];if(j.length>0){const I={};j.forEach(P=>{var b;((b=l.fields)==null?void 0:b[P])!==void 0&&(I[P]=l.fields[P])}),Object.keys(I).length>0&&await a().setFields(I)}return h},async clearCurrent(){const n=a().current;n&&(await w.survey_photos.where("draftId").equals(n.id).delete(),await w.survey_drafts.delete(n.id),d({current:void 0,photos:[]}),await f())},async listHistory(n="asc"){const l=w.survey_drafts.orderBy("updatedAt");return(n==="desc"?await l.reverse().toArray():await l.toArray()).filter(h=>{var j;return((j=h.fields)==null?void 0:j.status)==="completed"})},async purgeCompleted(){const n=await w.survey_drafts.filter(m=>{var h;return((h=m.fields)==null?void 0:h.status)==="completed"}).toArray();if(n.length===0)return 0;await w.transaction("rw",w.survey_drafts,w.survey_photos,async()=>{for(const m of n)await w.survey_photos.where("draftId").equals(m.id).delete(),await w.survey_drafts.delete(m.id)});const l=a().current;return l&&n.some(m=>m.id===l.id)&&d({current:void 0,photos:[]}),await f(),await t(),n.length},async duplicateDraft(n,l){if(l<=0)return 0;const m=await w.survey_drafts.get(n);if(!m)throw new Error("複製元の履歴が見つかりません");const h={...m.fields??{}},j=h.sealNo||h.qr||h.qrCode||m.qr;if(!j)throw new Error("複製元のQRコードが取得できませんでした");const I=j.match(/(\d+)(?!.*\d)/),P=I?I.index??-1:-1,b=I?parseInt(I[1],10):null,M=I?I[1].length:0,k=P>=0?j.slice(0,P):j,D=P>=0?j.slice(P+M):"",$=await w.survey_photos.where("draftId").equals(n).toArray(),_=[],E=[],R=Date.now(),U=g=>{if(b!==null){const p=b+g,L=String(p).padStart(M,"0");return`${k}${L}${D}`}return`${j}-${g}`};for(let g=1;g<=l;g++){const p=crypto.randomUUID(),L=U(g),T=[],B={...h,qr:L,qrCode:L,sealNo:L,status:"completed",completedAt:R+g};$.forEach(z=>{const Z=crypto.randomUUID();T.push(Z),E.push({...z,id:Z,draftId:p,createdAt:R+g})}),_.push({id:p,fields:B,photoIds:T,updatedAt:R+g})}await w.transaction("rw",w.survey_drafts,w.survey_photos,async()=>{E.length>0&&await w.survey_photos.bulkPut(E),_.length>0&&await w.survey_drafts.bulkPut(_)}),await f();const F=a().current;if(F){const g=await w.survey_drafts.get(F.id);g&&d({current:g})}return _.length}};return f(),y});function ft(){const{current:d,newDraft:a}=qe();o.useEffect(()=>{d||a()},[d,a])}const No="この端末ではカメラが利用できません",wo="ブラウザ環境ではありません",So="カメラの利用には HTTPS での接続が必要です";function Co(){if(typeof navigator>"u")return null;const d=navigator.mediaDevices;if(d!=null&&d.getUserMedia)return t=>d.getUserMedia(t);const a=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return a?t=>new Promise((f,N)=>{a.call(navigator,t,f,N)}):null}async function ko(){if(typeof navigator>"u")throw new Error(wo);if(typeof window<"u"&&"isSecureContext"in window&&!window.isSecureContext)throw new Error(So);const d=Co();if(!d)throw new Error(No);if(sessionStorage.getItem("cameraPermission")==="granted")return"granted";try{return(await d({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}},audio:!1})).getTracks().forEach(f=>f.stop()),sessionStorage.setItem("cameraPermission","granted"),"granted"}catch(t){const f=t;throw(f==null?void 0:f.name)==="NotAllowedError"||(f==null?void 0:f.name)==="SecurityError"?sessionStorage.setItem("cameraPermission","denied"):sessionStorage.removeItem("cameraPermission"),t instanceof Error?t:new Error(String(t))}}const as={},Eo="/poc-survey-offline-mock/".replace(/\/?$/,"/"),ns=d=>`${Eo}tesseract/${d.replace(/^\//,"")}`;var Ks;const Do=(Ks=as==null?void 0:as.VITE_TESSDATA_URL)==null?void 0:Ks.trim(),_o=ns("lang-data/"),Vs=(Do??_o).replace(/\/?$/,"/");let et=null,rs=!1;const Ro=6e4;function Oo(d,a,t){return new Promise((f,N)=>{const y=setTimeout(()=>{try{t==null||t()}catch{}N(new Error("OCR処理がタイムアウトしました"))},a);d.then(n=>{clearTimeout(y),f(n)},n=>{clearTimeout(y),N(n)})})}function Ao(d){return d.replace(/[\uFF01-\uFF5E]/g,a=>String.fromCharCode(a.charCodeAt(0)-65248)).replace(/\u3000/g," ")}function Mo(d){return Ao(d).toUpperCase().replace(/[\u2010-\u2015\u2212\u30FC\uFF0D\uFE63]/g,"-").replace(/[^0-9A-Z-]/g,"")}const ds=()=>{et=null,rs=!1};async function Fo(){return Zs.createWorker("eng",void 0,{workerPath:ns("worker.min.js"),corePath:ns("tesseract-core.wasm.js"),langPath:Vs,workerBlobURL:!1})}async function ls(){et||(et=Oo(Fo(),Ro,ds));try{const d=await et;return rs||(await d.setParameters({tessedit_char_whitelist:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-",tessedit_pageseg_mode:Zs.PSM.SINGLE_LINE}),rs=!0),d}catch(d){throw ds(),d instanceof Error?d:new Error("Tesseract workerの初期化に失敗しました")}}function Xs(){ls().catch(()=>{})}const Lo=["tesseract/lang-data/eng.traineddata.gz","tesseract/worker.min.js","tesseract/tesseract-core.wasm","tesseract/tesseract-core.wasm.js"];async function Po(){const d="/poc-survey-offline-mock/".replace(/\/?$/,"/");await Promise.all(Lo.map(async a=>{try{await fetch(`${d}${a}`,{cache:"force-cache"})}catch{}}))}async function Xo(){await Po(),await ls()}async function Uo(d){const a=await ls(),{data:t}=await a.recognize(d).catch(async m=>{throw await To(),m}),f=Array.isArray(t.lines)?t.lines:[],N=f.map(m=>{var h,j;return((j=(h=m.text)==null?void 0:h.trim)==null?void 0:j.call(h))??""}).filter(Boolean),y=f.reduce((m,h)=>!m||h.confidence>m.confidence?{text:h.text,confidence:h.confidence}:m,null),n=Mo((y==null?void 0:y.text)??t.text??""),l=(y==null?void 0:y.confidence)??t.confidence??0;return{text:n,rawText:t.text??"",candidates:N.length>0?N:(t.text??"").split(/\n+/).map(m=>m.trim()).filter(Boolean),confidence:l,method:"tesseract"}}async function To(){if(!et)return;await(await et).terminate(),ds()}async function Qo(d){let a=null;try{return await Uo(d)}catch(t){a=t instanceof Error?t:new Error(String(t))}if(a){const t=a.message;throw Vs.startsWith("http")?typeof navigator<"u"&&!navigator.onLine?new Error("OCR辞書データが未取得です。オンライン接続時に一度読み取りを実行し、キャッシュを作成してください。"):new Error(`OCR辞書データのダウンロードに失敗しました: ${t}`):new Error(`OCR辞書データの読み込みに失敗しました。詳細: ${t}`)}throw new Error("OCR処理に失敗しました。")}function _t(d,a){return a?d.toLowerCase().includes(a.toLowerCase()):!0}function Bo(){var H,J,he,fe,le,ce;ft();const d=ht(),{current:a,setFields:t}=qe(),[f,N]=o.useState([]),[y,n]=o.useState([]),[l,m]=o.useState([]),[h,j]=o.useState([]),[I,P]=o.useState(""),[b,M]=o.useState(""),[k,D]=o.useState(""),[$,_]=o.useState(""),[E,R]=o.useState(void 0),[U,F]=o.useState(void 0),[g,p]=o.useState(void 0),[L,T]=o.useState(void 0),B=o.useMemo(()=>{const r=new Date;return`${r.getFullYear()}年${String(r.getMonth()+1).padStart(2,"0")}月${String(r.getDate()).padStart(2,"0")}日`},[]),z=typeof window<"u"?sessionStorage.getItem("mockUserEmail")??"":"";o.useEffect(()=>{sessionStorage.setItem("visitedDepartment","1")},[]),o.useEffect(()=>{Promise.all([w.location_buildings.toArray(),w.location_floors.toArray(),w.location_departments.toArray(),w.location_divisions.toArray()]).then(([r,Q,W,K])=>{N(r),n(Q),m(W),j(K)})},[]),o.useEffect(()=>{var Q,W;if(!a)return;const r={};(Q=a.fields)!=null&&Q.surveyDate||(r.surveyDate=B),z&&((W=a.fields)==null?void 0:W.investigator)!==z&&(r.investigator=z),Object.keys(r).length>0&&t(r)},[a,z,t,B]);const Z=(H=a==null?void 0:a.fields)==null?void 0:H.buildingId,c=(J=a==null?void 0:a.fields)==null?void 0:J.floorId,x=(he=a==null?void 0:a.fields)==null?void 0:he.departmentId,O=(fe=a==null?void 0:a.fields)==null?void 0:fe.divisionId;o.useEffect(()=>{R(Z)},[Z]),o.useEffect(()=>{F(c)},[c]),o.useEffect(()=>{p(x)},[x]),o.useEffect(()=>{T(O)},[O]);const A=o.useMemo(()=>f.find(r=>r.id===E),[f,E]),C=o.useMemo(()=>y.find(r=>r.id===U),[y,U]),V=o.useMemo(()=>l.find(r=>r.id===g),[l,g]),X=o.useMemo(()=>h.find(r=>r.id===L),[h,L]);o.useEffect(()=>{P(A?A.name:"")},[A]),o.useEffect(()=>{M(C?C.name:"")},[C]),o.useEffect(()=>{D(V?V.name:"")},[V]),o.useEffect(()=>{_(X?X.name:"")},[X]);const G=o.useMemo(()=>f.filter(r=>_t(r.name,I)),[f,I]),re=o.useMemo(()=>y.filter(r=>E&&r.buildingId!==E?!1:_t(r.name,b)),[y,b,E]),se=o.useMemo(()=>l.filter(r=>E&&r.buildingId!==E||U&&r.floorId!==U?!1:_t(r.name,k)),[l,k,E,U]),ae=o.useMemo(()=>h.filter(r=>E&&r.buildingId!==E||U&&r.floorId!==U||g&&r.departmentId!==g?!1:_t(r.name,$)),[h,$,E,U,g]),ie=r=>{if(!r||E===r.id){P(""),M(""),D(""),_(""),R(void 0),F(void 0),p(void 0),T(void 0),t({buildingId:void 0,floorId:void 0,departmentId:void 0,divisionId:void 0});return}P(r.name),M(""),D(""),_(""),R(r.id),F(void 0),p(void 0),T(void 0),t({buildingId:r.id,floorId:void 0,departmentId:void 0,divisionId:void 0})},de=r=>{if(!r||U===r.id){M(""),D(""),_(""),F(void 0),p(void 0),T(void 0),t({buildingId:E,floorId:void 0,departmentId:void 0,divisionId:void 0});return}const Q=f.find(W=>W.id===r.buildingId);Q&&(P(Q.name),R(Q.id)),M(r.name),D(""),_(""),F(r.id),p(void 0),T(void 0),t({buildingId:r.buildingId,floorId:r.id,departmentId:void 0,divisionId:void 0})},we=r=>{if(!r||g===r.id){D(""),_(""),p(void 0),T(void 0),t({buildingId:E,floorId:U,departmentId:void 0,divisionId:void 0});return}const Q=f.find(K=>K.id===r.buildingId),W=y.find(K=>K.id===r.floorId);Q&&(P(Q.name),R(Q.id)),W&&(M(W.name),F(W.id)),D(r.name),_(""),p(r.id),T(void 0),t({buildingId:r.buildingId,floorId:r.floorId,departmentId:r.id,divisionId:void 0})},De=r=>{if(!r||L===r.id){_(""),T(void 0),t({buildingId:E,floorId:U,departmentId:g,divisionId:void 0});return}const Q=f.find(ee=>ee.id===r.buildingId),W=y.find(ee=>ee.id===r.floorId),K=l.find(ee=>ee.id===r.departmentId);Q&&(P(Q.name),R(Q.id)),W&&(M(W.name),F(W.id)),K&&(D(K.name),p(K.id)),_(r.name),T(r.id),t({buildingId:r.buildingId,floorId:r.floorId,departmentId:r.departmentId,divisionId:r.id})},v=!!(E&&U&&g&&L);return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-section",children:[e.jsx("h2",{className:"section-title",children:"部署入力"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["調査日",e.jsx("input",{value:((le=a==null?void 0:a.fields)==null?void 0:le.surveyDate)??B,disabled:!0})]}),e.jsxs("label",{children:["調査担当",e.jsx("input",{value:((ce=a==null?void 0:a.fields)==null?void 0:ce.investigator)??z,disabled:!0})]})]}),e.jsxs("div",{className:"grid",style:{marginTop:16},children:[e.jsxs("label",{children:["棟",e.jsx("input",{value:I,onChange:r=>P(r.target.value),placeholder:"棟を検索"})]}),e.jsx("div",{className:"option-list",children:G.map(r=>e.jsx("button",{onClick:()=>ie(r),className:r.id===E?"active":"",children:r.name},r.id))}),e.jsxs("label",{children:["階",e.jsx("input",{value:b,onChange:r=>M(r.target.value),placeholder:"階を検索"})]}),e.jsx("div",{className:"option-list",children:re.map(r=>{var Q;return e.jsxs("button",{onClick:()=>de(r),className:r.id===U?"active":"",children:[r.name,"（",((Q=f.find(W=>W.id===r.buildingId))==null?void 0:Q.name)??"","）"]},r.id)})}),e.jsxs("label",{children:["部署",e.jsx("input",{value:k,onChange:r=>D(r.target.value),placeholder:"部署を検索"})]}),e.jsx("div",{className:"option-list",children:se.map(r=>e.jsx("button",{onClick:()=>we(r),className:r.id===g?"active":"",children:r.name},r.id))}),e.jsxs("label",{children:["部門",e.jsx("input",{value:$,onChange:r=>_(r.target.value),placeholder:"部門を検索"})]}),e.jsx("div",{className:"option-list",children:ae.map(r=>e.jsx("button",{onClick:()=>De(r),className:r.id===L?"active":"",children:r.name},r.id))})]}),e.jsx("p",{className:"helper-text",children:"今日一日がんばって！！"})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{className:"ghost",onClick:()=>d("/home"),children:"ホーム"}),e.jsx("button",{onClick:()=>d("/survey/all"),disabled:!v,children:"次へ"})]})]})}const Yo=Object.freeze(Object.defineProperty({__proto__:null,default:Bo},Symbol.toStringTag,{value:"Module"})),cs=o.forwardRef(({onResult:d},a)=>{const t=o.useRef(null),f=o.useRef(null),N=o.useRef(null),[y,n]=o.useState(!1);o.useEffect(()=>(f.current=new os,()=>{var h;(h=N.current)==null||h.stop(),N.current=null,os.releaseAllStreams(),f.current=null,n(!1)}),[]);const l=o.useCallback(()=>{var h;(h=N.current)==null||h.stop(),N.current=null,os.releaseAllStreams(),n(!1)},[]),m=o.useCallback(async()=>{if(!(!t.current||!f.current)&&!y){n(!0);try{N.current=await f.current.decodeFromConstraints({video:{facingMode:"environment"}},t.current,h=>{h&&(d(h.getText()),l())})}catch(h){console.error(h),n(!1),N.current=null}}},[d,y,l]);return o.useImperativeHandle(a,()=>({start:m,stop:l}),[m,l]),e.jsxs("div",{className:"qr-container",style:{display:y?"block":"none"},children:[e.jsx("video",{ref:t,className:"qr-video",muted:!0,playsInline:!0}),y&&e.jsx("div",{className:"helper-text",style:{marginTop:8},children:"読み取り中です..."})]})}),Jo=Object.freeze(Object.defineProperty({__proto__:null,QRScanner:cs},Symbol.toStringTag,{value:"Module"}));function Ot({open:d,onClose:a}){const{listHistory:t,duplicateDraft:f}=qe(),[N,y]=o.useState("asc"),[n,l]=o.useState(!1),[m,h]=o.useState(null),[j,I]=o.useState([]),[P,b]=o.useState(null),[M,k]=o.useState({}),[D,$]=o.useState(null),_=async g=>{l(!0),h(null);try{const p=await t(g);I(p)}catch(p){const L=p instanceof Error?p.message:String(p);h(L),I([])}finally{l(!1)}};o.useEffect(()=>{d?(b(null),k({}),$(null),_(N)):(h(null),I([]))},[d,N]);const E=()=>{y(g=>g==="asc"?"desc":"asc")},R=(g,p)=>{k(L=>({...L,[g]:p}))},U=async g=>{const p=M[g]??"1",L=Number.parseInt(p,10);if(!Number.isFinite(L)||L<=0){b("複製数は1以上の整数を入力してください");return}$(g),b(null);try{const T=await f(g,L);b(`履歴を ${T} 件複製しました`),k(B=>({...B,[g]:""})),await _(N)}catch(T){const B=T instanceof Error?T.message:String(T);b(`複製に失敗しました: ${B}`)}finally{$(null)}},F=o.useMemo(()=>n?e.jsx("p",{className:"helper-text",children:"読み込み中..."}):m?e.jsxs("p",{className:"badge warn",children:["エラー: ",m]}):j.length===0?e.jsx("p",{className:"helper-text",children:"複製可能な履歴がありません。"}):j.map(g=>{const p=g.fields??{},L=p.completedAt??g.updatedAt,T=p.sealNo??p.qr??g.qr??"-",B=p.assetNo??"-",z=p.equipmentNo??"-",Z=p.width??"-",c=p.depth??"-",x=p.height??"-",O=p.note??"",A=M[g.id]??"";return e.jsxs("div",{className:"history-row static",children:[e.jsxs("div",{className:"history-meta",children:[e.jsx("span",{children:new Date(L).toLocaleString()}),e.jsxs("span",{className:"pill",children:["QR ",T]}),B!=="-"&&e.jsxs("span",{className:"pill",children:["資産 ",B]}),z!=="-"&&e.jsxs("span",{className:"pill",children:["備品 ",z]})]}),e.jsxs("div",{className:"history-tags",children:[e.jsxs("span",{className:"pill",children:["Category ",p.categoryId??"-"]}),e.jsxs("span",{className:"pill",children:["Sub ",p.subcategoryId??"-"]}),e.jsxs("span",{className:"pill",children:["Item ",p.itemId??"-"]}),e.jsxs("span",{className:"pill",children:["Maker ",p.makerId??"-"]}),e.jsxs("span",{className:"pill",children:["Model ",p.modelId??"-"]})]}),e.jsxs("div",{className:"history-meta",children:[e.jsxs("span",{children:["W: ",Z]}),e.jsxs("span",{children:["D: ",c]}),e.jsxs("span",{children:["H: ",x]}),O&&e.jsxs("span",{children:["備考: ",O]})]}),e.jsxs("div",{className:"history-duplicate",children:[e.jsx("input",{type:"number",min:1,placeholder:"複製数",value:A,onChange:C=>R(g.id,C.target.value)}),e.jsx("button",{type:"button",className:"secondary",onClick:()=>U(g.id),disabled:D===g.id,children:D===g.id?"複製中...":"複製"})]})]},g.id)}),[j,M,n,m,D]);return d?e.jsx("div",{className:"history-overlay",children:e.jsxs("div",{className:"history-panel",children:[e.jsxs("div",{className:"history-header",children:[e.jsx("h3",{children:"複製"}),e.jsxs("div",{className:"row",children:[e.jsx("button",{className:"ghost",onClick:E,children:N==="asc"?"降順にする":"昇順にする"}),e.jsx("button",{className:"ghost",onClick:a,children:"閉じる"})]})]}),P&&e.jsx("p",{className:"badge success",style:{marginTop:8},children:P}),e.jsx("div",{className:"history-list",children:F})]})}):null}function Ho(){var p,L,T,B,z,Z;ft();const d=ht(),a=o.useRef(null),{current:t,setFields:f,setQR:N}=qe(),[y,n]=o.useState(""),[l,m]=o.useState(""),[h,j]=o.useState([]),[I,P]=o.useState(!1);o.useEffect(()=>{var c,x;n(((c=t==null?void 0:t.fields)==null?void 0:c.sealNo)??""),m(((x=t==null?void 0:t.fields)==null?void 0:x.roomName)??"")},[(p=t==null?void 0:t.fields)==null?void 0:p.sealNo,(L=t==null?void 0:t.fields)==null?void 0:L.roomName]),o.useEffect(()=>()=>{var c;(c=a.current)==null||c.stop()},[]),o.useEffect(()=>{let c=!0;return w.location_rooms.toArray().then(x=>{c&&j(x)}).catch(()=>{c&&j([])}),()=>{c=!1}},[]);const b=(T=t==null?void 0:t.fields)==null?void 0:T.buildingId,M=(B=t==null?void 0:t.fields)==null?void 0:B.floorId,k=(z=t==null?void 0:t.fields)==null?void 0:z.departmentId,D=(Z=t==null?void 0:t.fields)==null?void 0:Z.divisionId,$=o.useMemo(()=>{if(!b||!M||!k||!D)return[];const c=l.trim().toLowerCase();return h.filter(x=>x.buildingId!==b||x.floorId!==M||x.departmentId!==k||x.divisionId!==D?!1:c?x.name.toLowerCase().includes(c):!0)},[h,b,M,k,D,l]),_=c=>{const x=c.trim(),O=x.match(/medical-record\/([A-Za-z0-9-]+)$/i),A=O?O[1]:x;n(A),N(A)},E=c=>{n(c),f({sealNo:c,qrCode:c})},R=c=>{m(c),f({roomName:c})},U=()=>{var c;(c=a.current)==null||c.stop(),d("/survey/department")},F=()=>{var c;(c=a.current)==null||c.stop(),d("/survey/asset")},g=!!(y.trim()&&l.trim());return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-section",children:[e.jsx("h2",{className:"section-title",children:"QRコード読取・ラベルNo確認"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["シールNo",e.jsx("input",{value:y,onChange:c=>E(c.target.value),placeholder:"シールNoを入力"})]}),e.jsxs("label",{children:["室名",e.jsx("input",{value:l,onChange:c=>R(c.target.value),placeholder:"室名を入力"}),$.length>0&&e.jsx("div",{className:"option-list",style:{marginTop:6},children:$.map(c=>e.jsx("button",{type:"button",onClick:()=>R(c.name),children:c.name},c.id))})]})]}),e.jsx("div",{style:{marginTop:16},children:e.jsx(cs,{ref:a,onResult:_})})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{className:"ghost",onClick:()=>P(!0),children:"複製"}),e.jsx("button",{className:"ghost",onClick:U,children:"戻る"}),e.jsx("button",{className:"secondary",onClick:async()=>{var c;try{await ko(),await((c=a.current)==null?void 0:c.start())}catch(x){const O=x instanceof Error?x.message:String(x);alert(`カメラを利用できませんでした: ${O}`)}},children:"QR撮影"}),e.jsx("button",{onClick:F,disabled:!g,children:"次へ"})]}),e.jsx(Ot,{open:I,onClose:()=>P(!1)})]})}const ea=Object.freeze(Object.defineProperty({__proto__:null,default:Ho},Symbol.toStringTag,{value:"Module"})),Rt={left:.08,top:.425,width:.84,height:.15},Gs=1200,$o=2e3;function is(d,a){const t=d.split(","),f=t[0].match(/:(.*?);/),N=(f==null?void 0:f[1])??a,y=atob(t[1]??""),n=y.length,l=new Uint8Array(n);for(let m=0;m<n;m+=1)l[m]=y.charCodeAt(m);return new Blob([l],{type:N})}async function qo(d,a,t){return typeof d.toBlob=="function"?await new Promise((f,N)=>{let y=!1;const n=window.setTimeout(()=>{if(!y){y=!0;try{const l=is(d.toDataURL(a,t),a);f(l)}catch(l){N(l instanceof Error?l:new Error("スナップショットの生成に失敗しました"))}}},$o);d.toBlob(l=>{if(!y)if(y=!0,window.clearTimeout(n),l)f(l);else try{const m=is(d.toDataURL(a,t),a);f(m)}catch(m){N(m instanceof Error?m:new Error("スナップショットの生成に失敗しました"))}},a,t)}):is(d.toDataURL(a,t),a)}function Ys({open:d,targetLabel:a,onClose:t,onResult:f,onRecognized:N}){const y=o.useRef(null),n=o.useRef(null),l=o.useRef(),m=o.useRef(),h=o.useRef(null),[j,I]=o.useState("idle"),[P,b]=o.useState("カメラを初期化しています…"),[M,k]=o.useState(!1),[D,$]=o.useState(null),[_,E]=o.useState(null);o.useEffect(()=>{l.current=document.createElement("canvas"),m.current=document.createElement("canvas")},[]);const R=o.useCallback(()=>{$(null),E(c=>(c&&URL.revokeObjectURL(c),null))},[]),U=()=>{n.current&&(n.current.getTracks().forEach(c=>c.stop()),n.current=null),y.current&&(y.current.pause(),y.current.srcObject=null)},F=o.useCallback(async()=>{var c;if(R(),!((c=navigator.mediaDevices)!=null&&c.getUserMedia)){I("error"),b("この端末ではカメラを利用できません。手入力してください。"),k(!1);return}I("camera"),b("カメラを起動しています…");try{const x=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}}});n.current=x,y.current&&(y.current.srcObject=x,await y.current.play().catch(()=>{})),I("camera"),b("枠が黒い帯に変わりました。番号を合わせて撮影してください。"),k(!1)}catch(x){const O=x instanceof Error?x.message:String(x);I("error"),b(`カメラにアクセスできません: ${O}`),k(!1)}},[R]);o.useEffect(()=>{if(!d){U(),R(),I("idle"),b("カメラを初期化しています…"),k(!1);return}return F(),()=>{U()}},[d,F]);const g=async(c,x,O)=>{const A=l.current,C=m.current;if(!A||!C||c===0||x===0)throw new Error("画像データを読み込めませんでした。");A.width=c,A.height=x;const V=A.getContext("2d");if(!V)throw new Error("画像の処理に失敗しました。");O(V);const X=C.getContext("2d");if(!X)throw new Error("画像の処理に失敗しました。");const G={x:Math.floor(A.width*Rt.left),y:Math.floor(A.height*Rt.top),width:Math.floor(A.width*Rt.width),height:Math.floor(A.height*Rt.height)},re=G.width>Gs?Gs/G.width:1,se=Math.max(320,Math.round(G.width*re)),ae=Math.max(120,Math.round(G.height*re));return C.width=se,C.height=ae,X.filter="contrast(160%) brightness(115%) grayscale(15%)",X.drawImage(A,G.x,G.y,G.width,G.height,0,0,se,ae),qo(C,"image/jpeg",.92)},p=async()=>{if(!d||M||j!=="camera")return;const c=y.current;if(!c||c.videoWidth===0||c.videoHeight===0){I("error"),b("カメラ映像を取得できませんでした。");return}k(!0),b("撮影中…");try{const x=await g(c.videoWidth,c.videoHeight,A=>{A.drawImage(c,0,0,c.videoWidth,c.videoHeight)});U(),R();const O=URL.createObjectURL(x);$(x),E(O),I("photo"),b("写真を保存しました。読み取りボタンを押してください。"),k(!1)}catch(x){const O=x instanceof Error?x.message:String(x);I("error"),b(`撮影に失敗しました: ${O}`),k(!1)}},L=c=>new Promise((x,O)=>{const A=URL.createObjectURL(c),C=new Image;C.onload=()=>{URL.revokeObjectURL(A),x(C)},C.onerror=V=>{URL.revokeObjectURL(A),O(V)},C.src=A}),T=async c=>{if(!c||c.length===0)return;const x=c[0];k(!0),b("画像を処理しています…");try{let O;if(typeof createImageBitmap=="function"){const C=await createImageBitmap(x);O=await g(C.width,C.height,V=>{V.drawImage(C,0,0,C.width,C.height)}),C.close()}else{const C=await L(x),V=C.naturalWidth||C.width,X=C.naturalHeight||C.height;O=await g(V,X,G=>{G.drawImage(C,0,0,V,X)})}U(),R();const A=URL.createObjectURL(O);$(O),E(A),I("photo"),b("写真を保存しました。読み取りボタンを押してください。")}catch(O){const A=O instanceof Error?O.message:String(O);I("error"),b(`画像の処理に失敗しました: ${A}`)}finally{k(!1),h.current&&(h.current.value="")}},B=async()=>{if(!(!D||M)){I("processing"),k(!0),b("読み取り中です。1秒ほどお待ちください…");try{const c=await Qo(D);c.text?(f(c.text),b(`認識した値: ${c.text}`),N==null||N({text:c.text,method:c.method,targetLabel:a}),t()):(I("error"),b("文字を検出できませんでした。撮り直して再試行してください。"),k(!1))}catch(c){const x=c instanceof Error?c.message:String(c);I("error"),b(`読み取りに失敗しました: ${x}`),k(!1)}}},z=()=>{M||(R(),F())},Z=o.useMemo(()=>j==="photo"?"撮影した画像を確認し、問題なければ「読み取る」を押してください。":j==="processing"?"しばらくお待ちください…":j==="error"?"カメラや照明の状態を確認してください。":"黒いガイド帯の中央に番号を重ね、影や反射を避けて撮影すると精度が上がります。",[j]);return d?e.jsx("div",{className:"ocr-overlay",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"ocr-panel",children:[e.jsxs("header",{className:"ocr-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"ocr-eyebrow",children:"テキストスキャン"}),e.jsxs("h3",{children:[a,"の読み取り"]})]}),e.jsx("button",{type:"button",className:"ghost",onClick:t,children:"閉じる"})]}),e.jsxs("div",{className:"ocr-video-container",children:[e.jsx("input",{type:"file",accept:"image/*",ref:h,style:{display:"none"},onChange:c=>T(c.target.files)}),_?e.jsx("img",{src:_,alt:"撮影した画像",className:"ocr-preview"}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:y,playsInline:!0,autoPlay:!0,muted:!0,className:"ocr-video"}),e.jsx("div",{className:"ocr-frame","aria-hidden":"true",children:e.jsx("span",{className:"ocr-frame__label",children:"黒い帯に合わせてください"})})]})]}),e.jsx("p",{className:"helper-text",children:Z}),e.jsx("p",{className:`ocr-message ${j==="error"?"is-error":""}`,children:P}),e.jsxs("footer",{className:"ocr-footer",children:[e.jsx("button",{type:"button",className:"ghost",onClick:t,disabled:M&&j==="processing",children:"キャンセル"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{var c;return(c=h.current)==null?void 0:c.click()},disabled:M,children:"画像をアップロード"}),D&&e.jsx("button",{type:"button",className:"ghost",onClick:z,disabled:M,children:"撮り直し"}),!D&&e.jsx("button",{type:"button",onClick:p,className:"secondary",disabled:M||j!=="camera",children:"撮影する"}),D&&e.jsx("button",{type:"button",onClick:B,className:"secondary",disabled:M,children:j==="processing"?"読み取り中...":"読み取る"})]})]})}):null}function Wo(){var G,re,se,ae,ie,de,we,De;ft();const d=ht(),a=o.useRef(null),{current:t,photos:f,attachPhoto:N,removePhoto:y,setFields:n}=qe(),[l,m]=o.useState(""),[h,j]=o.useState(""),[I,P]=o.useState(""),[b,M]=o.useState(!1),[k,D]=o.useState(!1),[$,_]=o.useState(!1),[E,R]=o.useState("assetNo"),[U,F]=o.useState(!1),[g,p]=o.useState(null);o.useEffect(()=>{Xs()},[]),o.useEffect(()=>{var v,H,J,he,fe;m(((v=t==null?void 0:t.fields)==null?void 0:v.assetNo)??""),j(((H=t==null?void 0:t.fields)==null?void 0:H.equipmentNo)??""),P(((J=t==null?void 0:t.fields)==null?void 0:J.purchaseDate)??""),M(!!((he=t==null?void 0:t.fields)!=null&&he.leaseFlag)),D(!!((fe=t==null?void 0:t.fields)!=null&&fe.loanedFlag))},[(G=t==null?void 0:t.fields)==null?void 0:G.assetNo,(re=t==null?void 0:t.fields)==null?void 0:re.equipmentNo,(se=t==null?void 0:t.fields)==null?void 0:se.purchaseDate,(ae=t==null?void 0:t.fields)==null?void 0:ae.leaseFlag,(ie=t==null?void 0:t.fields)==null?void 0:ie.loanedFlag]),o.useEffect(()=>{var v;if(!((v=t==null?void 0:t.fields)!=null&&v.purchaseDate)){const H=new Date;H.setHours(0,0,0,0);const J=H.toISOString().slice(0,10);P(J),n({purchaseDate:J})}},[(de=t==null?void 0:t.fields)==null?void 0:de.purchaseDate,n]);const L=((we=t==null?void 0:t.fields)==null?void 0:we.sealNo)??"",T=((De=t==null?void 0:t.fields)==null?void 0:De.roomName)??"",B=o.useMemo(()=>f.map(v=>({id:v.id,url:URL.createObjectURL(v.thumb)})),[f]);o.useEffect(()=>()=>{B.forEach(v=>URL.revokeObjectURL(v.url))},[B]);const z=async v=>{if(!v||v.length===0)return;const H=v[0];await N(H),a.current&&(a.current.value="")},Z=()=>{const v=!b;M(v),n({leaseFlag:v})},c=()=>{const v=!k;D(v),n({loanedFlag:v})},x=()=>{d("/survey/label")},O=()=>{d("/survey/product")},A=f.length>0,C=v=>{v&&(E==="assetNo"?(m(v),n({assetNo:v})):(j(v),n({equipmentNo:v})))},V=o.useCallback(v=>{p(`${v.targetLabel}を読み取り: ${v.text}`)},[]);o.useEffect(()=>{if(!g)return;const v=window.setTimeout(()=>p(null),5e3);return()=>{window.clearTimeout(v)}},[g]);const X=v=>{R(v),F(!0)};return e.jsxs("div",{className:"page",children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:a,style:{display:"none"},onChange:v=>z(v.target.files)}),e.jsxs("div",{className:"page-section",children:[g&&e.jsx("div",{className:"ocr-result-banner",children:g}),e.jsx("h2",{className:"section-title",children:"写真撮影・資産No登録"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["シールNo",e.jsx("input",{value:L,disabled:!0})]}),e.jsxs("label",{children:["室名",e.jsx("input",{value:T,disabled:!0})]}),e.jsxs("label",{children:["資産番号",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:l,onChange:v=>{const H=v.target.value;m(H),n({assetNo:H})}}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:()=>X("assetNo"),children:"読み取り"})]})]}),e.jsxs("label",{children:["備品番号",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:h,onChange:v=>{const H=v.target.value;j(H),n({equipmentNo:H})}}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:()=>X("equipmentNo"),children:"読み取り"})]})]}),e.jsxs("label",{children:["購入年月日",e.jsx("input",{type:"date",value:I,onChange:v=>{const H=v.target.value;P(H),n({purchaseDate:H})}})]}),e.jsxs("div",{className:"row",children:[e.jsxs("button",{type:"button",className:b?"secondary":"ghost",onClick:Z,children:["リース: ",b?"ON":"OFF"]}),e.jsxs("button",{type:"button",className:k?"secondary":"ghost",onClick:c,children:["貸出品: ",k?"ON":"OFF"]})]})]}),e.jsx("div",{className:"photo-strip",children:B.map(v=>e.jsxs("div",{className:"photo-item",children:[e.jsx("button",{type:"button",className:"photo-remove",onClick:()=>y(v.id),"aria-label":"写真を削除",children:"×"}),e.jsx("img",{src:v.url,alt:"サムネイル"})]},v.id))})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{className:"ghost",onClick:()=>_(!0),children:"複製"}),e.jsx("button",{className:"ghost",onClick:x,children:"戻る"}),e.jsx("button",{className:"secondary",onClick:()=>{var v;return(v=a.current)==null?void 0:v.click()},children:"写真"}),e.jsx("button",{onClick:O,disabled:!A,children:"次へ"})]}),e.jsx(Ot,{open:$,onClose:()=>_(!1)}),e.jsx(Ys,{open:U,targetLabel:E==="assetNo"?"資産番号":"備品番号",onClose:()=>F(!1),onResult:C,onRecognized:V})]})}const ta=Object.freeze(Object.defineProperty({__proto__:null,default:Wo},Symbol.toStringTag,{value:"Module"}));function mt(d,a){return a?d.toLowerCase().includes(a.toLowerCase()):!0}function zo(){var dt,He,lt,yt,It,We,xt,jt,bt;ft();const d=ht(),{current:a,setFields:t,completeCurrent:f,listHistory:N}=qe(),[y,n]=o.useState([]),[l,m]=o.useState([]),[h,j]=o.useState([]),[I,P]=o.useState([]),[b,M]=o.useState([]),[k,D]=o.useState(""),[$,_]=o.useState(""),[E,R]=o.useState(""),[U,F]=o.useState(""),[g,p]=o.useState(""),[L,T]=o.useState(""),[B,z]=o.useState(""),[Z,c]=o.useState(""),[x,O]=o.useState(""),[A,C]=o.useState(!1),[V,X]=o.useState(!1),[G,re]=o.useState([]),[se,ae]=o.useState(!1),[ie,de]=o.useState(null),[we,De]=o.useState("asc"),v=o.useRef(void 0),H=o.useRef(void 0),J=o.useRef(void 0),he=o.useRef(void 0),fe=o.useRef(void 0);o.useEffect(()=>{Promise.all([w.product_categories.toArray(),w.product_subcategories.toArray(),w.product_items.toArray(),w.product_makers.toArray(),w.product_models.toArray()]).then(([i,S,ue,be,ge])=>{n(i),m(S),j(ue),P(be),M(ge)})},[]),o.useEffect(()=>{var i,S,ue,be;T(((i=a==null?void 0:a.fields)==null?void 0:i.width)??""),z(((S=a==null?void 0:a.fields)==null?void 0:S.depth)??""),c(((ue=a==null?void 0:a.fields)==null?void 0:ue.height)??""),O(((be=a==null?void 0:a.fields)==null?void 0:be.note)??"")},[(dt=a==null?void 0:a.fields)==null?void 0:dt.width,(He=a==null?void 0:a.fields)==null?void 0:He.depth,(lt=a==null?void 0:a.fields)==null?void 0:lt.height,(yt=a==null?void 0:a.fields)==null?void 0:yt.note]);const le=(It=a==null?void 0:a.fields)==null?void 0:It.categoryId,ce=(We=a==null?void 0:a.fields)==null?void 0:We.subcategoryId,r=(xt=a==null?void 0:a.fields)==null?void 0:xt.itemId,Q=(jt=a==null?void 0:a.fields)==null?void 0:jt.makerId,W=(bt=a==null?void 0:a.fields)==null?void 0:bt.modelId,K=y.find(i=>i.id===le),ee=l.find(i=>i.id===ce),xe=h.find(i=>i.id===r),pe=I.find(i=>i.id===Q),je=b.find(i=>i.id===W);o.useEffect(()=>{(K==null?void 0:K.id)!==v.current&&(K?D(K.name):v.current&&D(""),v.current=K==null?void 0:K.id)},[K]),o.useEffect(()=>{(ee==null?void 0:ee.id)!==H.current&&(ee?_(ee.name):H.current&&_(""),H.current=ee==null?void 0:ee.id)},[ee]),o.useEffect(()=>{(xe==null?void 0:xe.id)!==J.current&&(xe?R(xe.name):J.current&&R(""),J.current=xe==null?void 0:xe.id)},[xe]),o.useEffect(()=>{(pe==null?void 0:pe.id)!==he.current&&(pe?F(pe.name):he.current&&F(""),he.current=pe==null?void 0:pe.id)},[pe]),o.useEffect(()=>{(je==null?void 0:je.id)!==fe.current&&(je?p(je.name):fe.current&&p(""),fe.current=je==null?void 0:je.id)},[je]);const tt=o.useMemo(()=>y.filter(i=>mt(i.name,k)),[y,k]),At=o.useMemo(()=>l.filter(i=>mt(i.name,$)),[l,$]),st=o.useMemo(()=>h.filter(i=>mt(i.name,E)),[h,E]),Mt=o.useMemo(()=>I.filter(i=>mt(i.name,U)),[I,U]),ot=o.useMemo(()=>b.filter(i=>mt(i.name,g)),[b,g]),Ft=i=>{if(le===i.id){D(""),_(""),R(""),F(""),p(""),t({categoryId:void 0,subcategoryId:void 0,itemId:void 0,makerId:void 0,modelId:void 0});return}D(i.name),_(""),R(""),F(""),p(""),t({categoryId:i.id,subcategoryId:void 0,itemId:void 0,makerId:void 0,modelId:void 0})},at=i=>{if(ce===i.id){_(""),R(""),F(""),p(""),t({categoryId:le??i.categoryId,subcategoryId:void 0,itemId:void 0,makerId:void 0,modelId:void 0});return}_(i.name),R(""),F(""),p(""),t({categoryId:i.categoryId,subcategoryId:i.id,itemId:void 0,makerId:void 0,modelId:void 0})},it=i=>{if(r===i.id){R(""),F(""),p(""),t({categoryId:le??i.categoryId,subcategoryId:ce??i.subcategoryId,itemId:void 0,makerId:void 0,modelId:void 0});return}R(i.name),F(""),p(""),t({categoryId:i.categoryId,subcategoryId:i.subcategoryId,itemId:i.id,makerId:void 0,modelId:void 0})},pt=i=>{if(Q===i.id){F(""),p(""),t({categoryId:le??i.categoryId,subcategoryId:ce??i.subcategoryId,itemId:r??i.itemId,makerId:void 0,modelId:void 0});return}F(i.name),p(""),t({categoryId:i.categoryId,subcategoryId:i.subcategoryId,itemId:i.itemId,makerId:i.id,modelId:void 0})},nt=i=>{if(W===i.id){p(""),t({categoryId:le??i.categoryId,subcategoryId:ce??i.subcategoryId,itemId:r??i.itemId,makerId:Q??i.makerId,modelId:void 0});return}p(i.name),t({categoryId:i.categoryId,subcategoryId:i.subcategoryId,itemId:i.itemId,makerId:i.makerId,modelId:i.id})},rt=o.useCallback(async i=>{ae(!0),de(null);try{const S=await N(i);re(S)}catch(S){const ue=S instanceof Error?S.message:String(S);de(ue),re([])}finally{ae(!1)}},[N]);o.useEffect(()=>{A?rt(we):de(null)},[A,we,rt]);const Lt=i=>{const S=i.categoryId,ue=i.subcategoryId,be=i.itemId,ge=i.makerId,ze=i.modelId,Se=i.width!=null?String(i.width):"",Ge=i.depth!=null?String(i.depth):"",Ce=i.height!=null?String(i.height):"",Ke=i.note!=null?String(i.note):"";T(Se),z(Ge),c(Ce),O(Ke);const Ne=y.find(Y=>Y.id===S),Ue=l.find(Y=>Y.id===ue),ve=h.find(Y=>Y.id===be),Te=I.find(Y=>Y.id===ge),ke=b.find(Y=>Y.id===ze);D((Ne==null?void 0:Ne.name)??""),_((Ue==null?void 0:Ue.name)??""),R((ve==null?void 0:ve.name)??""),F((Te==null?void 0:Te.name)??""),p((ke==null?void 0:ke.name)??""),t({categoryId:S,subcategoryId:ue,itemId:be,makerId:ge,modelId:ze,width:Se,depth:Ge,height:Ce,note:Ke})},gt=i=>{Lt(i.fields??{}),C(!1)},vt=()=>{De(i=>i==="asc"?"desc":"asc")},Pt=async()=>{await f({preserveKeys:["surveyDate","investigator","buildingId","floorId","departmentId","divisionId"]}),d("/survey/label")},Ut=()=>{t({buildingId:void 0,floorId:void 0,departmentId:void 0,divisionId:void 0}),d("/survey/department")};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-section",children:[e.jsx("h2",{className:"section-title",children:"商品登録"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["大分類",e.jsx("input",{value:k,onChange:i=>D(i.target.value),placeholder:"大分類を検索"})]}),e.jsx("div",{className:"option-list",children:tt.map(i=>e.jsx("button",{onClick:()=>Ft(i),className:i.id===le?"active":"",children:i.name},i.id))}),e.jsxs("label",{children:["中分類",e.jsx("input",{value:$,onChange:i=>_(i.target.value),placeholder:"中分類を検索"})]}),e.jsx("div",{className:"option-list",children:At.map(i=>e.jsx("button",{onClick:()=>at(i),className:i.id===ce?"active":"",children:i.name},i.id))}),e.jsxs("label",{children:["品目",e.jsx("input",{value:E,onChange:i=>R(i.target.value),placeholder:"品目を検索"})]}),e.jsx("div",{className:"option-list",children:st.map(i=>e.jsx("button",{onClick:()=>it(i),className:i.id===r?"active":"",children:i.name},i.id))}),e.jsxs("label",{children:["メーカー名",e.jsx("input",{value:U,onChange:i=>F(i.target.value),placeholder:"メーカー名を検索"})]}),e.jsx("div",{className:"option-list",children:Mt.map(i=>e.jsx("button",{onClick:()=>pt(i),className:i.id===Q?"active":"",children:i.name},i.id))}),e.jsxs("label",{children:["型式",e.jsx("input",{value:g,onChange:i=>p(i.target.value),placeholder:"型式を検索"})]}),e.jsx("div",{className:"option-list",children:ot.map(i=>e.jsx("button",{onClick:()=>nt(i),className:i.id===W?"active":"",children:i.name},i.id))})]}),e.jsxs("div",{className:"grid",style:{marginTop:16},children:[e.jsxs("label",{children:["W",e.jsx("input",{value:L,onChange:i=>{const S=i.target.value;T(S),t({width:S})},placeholder:"mm"})]}),e.jsxs("label",{children:["D",e.jsx("input",{value:B,onChange:i=>{const S=i.target.value;z(S),t({depth:S})},placeholder:"mm"})]}),e.jsxs("label",{children:["H",e.jsx("input",{value:Z,onChange:i=>{const S=i.target.value;c(S),t({height:S})},placeholder:"mm"})]}),e.jsxs("label",{children:["備考",e.jsx("textarea",{value:x,onChange:i=>{const S=i.target.value;O(S),t({note:S})},rows:3})]})]}),e.jsx("div",{className:"row",style:{justifyContent:"flex-start",marginTop:8},children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>C(!0),children:"履歴表示"})})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>X(!0),children:"複製"}),e.jsx("button",{className:"ghost",onClick:()=>d("/survey/asset"),children:"戻る"}),e.jsx("button",{className:"secondary",onClick:Ut,children:"部門"}),e.jsx("button",{onClick:Pt,children:"次へ"})]}),A&&e.jsx("div",{className:"history-overlay",children:e.jsxs("div",{className:"history-panel",children:[e.jsxs("div",{className:"history-header",children:[e.jsx("h3",{children:"作業履歴"}),e.jsxs("div",{className:"row",children:[e.jsx("button",{className:"ghost",onClick:vt,children:we==="asc"?"降順にする":"昇順にする"}),e.jsx("button",{className:"ghost",onClick:()=>C(!1),children:"閉じる"})]})]}),se&&e.jsx("p",{className:"helper-text",children:"読み込み中..."}),ie&&e.jsxs("p",{className:"badge warn",children:["エラー: ",ie]}),!se&&!ie&&G.length===0&&e.jsx("p",{className:"helper-text",children:"表示できる履歴がありません。"}),!se&&!ie&&G.length>0&&e.jsx("div",{className:"history-list",children:G.map(i=>{var Ue,ve,Te,ke,Y;const S=i.fields??{},ue=S.completedAt??i.updatedAt,be=((Ue=y.find(me=>me.id===S.categoryId))==null?void 0:Ue.name)??"-",ge=((ve=l.find(me=>me.id===S.subcategoryId))==null?void 0:ve.name)??"-",ze=((Te=h.find(me=>me.id===S.itemId))==null?void 0:Te.name)??"-",Se=((ke=I.find(me=>me.id===S.makerId))==null?void 0:ke.name)??"-",Ge=((Y=b.find(me=>me.id===S.modelId))==null?void 0:Y.name)??"-",Ce=S.width??"-",Ke=S.depth??"-",Ne=S.height??"-";return e.jsxs("button",{type:"button",className:"history-row",onClick:()=>gt(i),children:[e.jsxs("div",{className:"history-meta",children:[e.jsx("span",{children:new Date(ue).toLocaleString()}),S.assetNo&&e.jsxs("span",{className:"pill",children:["資産 ",S.assetNo]}),S.equipmentNo&&e.jsxs("span",{className:"pill",children:["備品 ",S.equipmentNo]}),S.sealNo&&e.jsxs("span",{className:"pill",children:["QR ",S.sealNo]})]}),e.jsxs("div",{className:"history-tags",children:[e.jsx("span",{className:"pill",children:be}),e.jsx("span",{className:"pill",children:ge}),e.jsx("span",{className:"pill",children:ze}),e.jsx("span",{className:"pill",children:Se}),e.jsx("span",{className:"pill",children:Ge})]}),e.jsxs("div",{className:"history-meta",children:[e.jsxs("span",{children:["W: ",Ce]}),e.jsxs("span",{children:["D: ",Ke]}),e.jsxs("span",{children:["H: ",Ne]})]})]},i.id)})})]})}),e.jsx(Ot,{open:V,onClose:()=>X(!1)})]})}const sa=Object.freeze(Object.defineProperty({__proto__:null,default:zo},Symbol.toStringTag,{value:"Module"}));function Pe(d,a){return a?d.toLowerCase().includes(a.toLowerCase()):!0}function oa(){var ys,Is,xs,js,bs,Ns,ws,Ss,Cs,ks,Es,Ds,_s,Rs,Os,As,Ms,Fs,Ls,Ps,Us,Ts,Qs,Bs,Hs,$s,qs;ft();const d=ht(),a=qe(),{current:t,photos:f,attachPhoto:N,removePhoto:y,setFields:n,completeCurrent:l,listHistory:m}=a,[h,j]=o.useState([]),[I,P]=o.useState([]),[b,M]=o.useState([]),[k,D]=o.useState([]),[$,_]=o.useState(""),[E,R]=o.useState(""),[U,F]=o.useState(""),[g,p]=o.useState(""),[L,T]=o.useState(void 0),[B,z]=o.useState(void 0),[Z,c]=o.useState(void 0),[x,O]=o.useState(void 0),A=o.useMemo(()=>{const s=new Date;return`${s.getFullYear()}年${String(s.getMonth()+1).padStart(2,"0")}月${String(s.getDate()).padStart(2,"0")}日`},[]),C=typeof window<"u"?sessionStorage.getItem("mockUserEmail")??"":"";o.useEffect(()=>{Promise.all([w.location_buildings.toArray(),w.location_floors.toArray(),w.location_departments.toArray(),w.location_divisions.toArray()]).then(([s,u,q,te])=>{j(s),P(u),M(q),D(te)})},[]),o.useEffect(()=>{var u,q;if(!t)return;const s={};(u=t.fields)!=null&&u.surveyDate||(s.surveyDate=A),C&&((q=t.fields)==null?void 0:q.investigator)!==C&&(s.investigator=C),Object.keys(s).length>0&&n(s)},[t,C,n,A]);const V=(ys=t==null?void 0:t.fields)==null?void 0:ys.buildingId,X=(Is=t==null?void 0:t.fields)==null?void 0:Is.floorId,G=(xs=t==null?void 0:t.fields)==null?void 0:xs.departmentId,re=(js=t==null?void 0:t.fields)==null?void 0:js.divisionId;o.useEffect(()=>{T(V)},[V]),o.useEffect(()=>{z(X)},[X]),o.useEffect(()=>{c(G)},[G]),o.useEffect(()=>{O(re)},[re]);const se=o.useMemo(()=>h.find(s=>s.id===L),[h,L]),ae=o.useMemo(()=>I.find(s=>s.id===B),[I,B]),ie=o.useMemo(()=>b.find(s=>s.id===Z),[b,Z]),de=o.useMemo(()=>k.find(s=>s.id===x),[k,x]);o.useEffect(()=>{_((se==null?void 0:se.name)??"")},[se]),o.useEffect(()=>{R((ae==null?void 0:ae.name)??"")},[ae]),o.useEffect(()=>{F((ie==null?void 0:ie.name)??"")},[ie]),o.useEffect(()=>{p((de==null?void 0:de.name)??"")},[de]),o.useMemo(()=>h.filter(s=>Pe(s.name,$)),[h,$]),o.useMemo(()=>I.filter(s=>Pe(s.name,E)),[I,E]),o.useMemo(()=>b.filter(s=>Pe(s.name,U)),[b,U]),o.useMemo(()=>k.filter(s=>Pe(s.name,g)),[k,g]);const we=!!(L&&B&&Z&&x),De=o.useRef(null),[v,H]=o.useState(""),[J,he]=o.useState(""),[fe,le]=o.useState([]);o.useEffect(()=>{var s,u;H(((s=t==null?void 0:t.fields)==null?void 0:s.sealNo)??""),he(((u=t==null?void 0:t.fields)==null?void 0:u.roomName)??"")},[(bs=t==null?void 0:t.fields)==null?void 0:bs.sealNo,(Ns=t==null?void 0:t.fields)==null?void 0:Ns.roomName]),o.useEffect(()=>()=>{var s;(s=De.current)==null||s.stop()},[]),o.useEffect(()=>{let s=!0;return w.location_rooms.toArray().then(u=>{s&&le(u)}).catch(()=>{s&&le([])}),()=>{s=!1}},[]);const ce=(ws=t==null?void 0:t.fields)==null?void 0:ws.buildingId,r=(Ss=t==null?void 0:t.fields)==null?void 0:Ss.floorId,Q=(Cs=t==null?void 0:t.fields)==null?void 0:Cs.departmentId,W=(ks=t==null?void 0:t.fields)==null?void 0:ks.divisionId,K=o.useMemo(()=>{if(!ce||!r||!Q||!W)return[];const s=J.trim().toLowerCase();return fe.filter(u=>u.buildingId!==ce||u.floorId!==r||u.departmentId!==Q||u.divisionId!==W?!1:s?u.name.toLowerCase().includes(s):!0)},[fe,ce,r,Q,W,J]),ee=s=>{const u=s.trim(),q=u.match(/medical-record\/([A-Za-z0-9-]+)$/i),te=q?q[1]:u;H(te),a.setQR(te)},xe=s=>{H(s),n({sealNo:s,qrCode:s})},pe=s=>{he(s),n({roomName:s})},je=!!(v.trim()&&J.trim()),tt=o.useRef(null),[At,st]=o.useState(""),[Mt,ot]=o.useState(""),[Ft,at]=o.useState(""),[it,pt]=o.useState(!1),[nt,rt]=o.useState(!1),[Lt,gt]=o.useState(!1),[vt,Pt]=o.useState("assetNo"),[Ut,dt]=o.useState(!1),[He,lt]=o.useState(null);o.useEffect(()=>{Xs()},[]),o.useEffect(()=>{var s,u,q,te,Fe;st(((s=t==null?void 0:t.fields)==null?void 0:s.assetNo)??""),ot(((u=t==null?void 0:t.fields)==null?void 0:u.equipmentNo)??""),at(((q=t==null?void 0:t.fields)==null?void 0:q.purchaseDate)??""),pt(!!((te=t==null?void 0:t.fields)!=null&&te.leaseFlag)),rt(!!((Fe=t==null?void 0:t.fields)!=null&&Fe.loanedFlag))},[(Es=t==null?void 0:t.fields)==null?void 0:Es.assetNo,(Ds=t==null?void 0:t.fields)==null?void 0:Ds.equipmentNo,(_s=t==null?void 0:t.fields)==null?void 0:_s.purchaseDate,(Rs=t==null?void 0:t.fields)==null?void 0:Rs.leaseFlag,(Os=t==null?void 0:t.fields)==null?void 0:Os.loanedFlag]),o.useEffect(()=>{var s;if(!((s=t==null?void 0:t.fields)!=null&&s.purchaseDate)){const u=new Date;u.setHours(0,0,0,0);const q=u.toISOString().slice(0,10);at(q),n({purchaseDate:q})}},[(As=t==null?void 0:t.fields)==null?void 0:As.purchaseDate,n]);const yt=((Ms=t==null?void 0:t.fields)==null?void 0:Ms.sealNo)??"",It=((Fs=t==null?void 0:t.fields)==null?void 0:Fs.roomName)??"",We=o.useMemo(()=>f.map(s=>({id:s.id,url:URL.createObjectURL(s.thumb)})),[f]);o.useEffect(()=>()=>{We.forEach(s=>URL.revokeObjectURL(s.url))},[We]);const xt=async s=>{if(!s||s.length===0)return;const u=s[0];await N(u),tt.current&&(tt.current.value="")},jt=()=>{const s=!it;pt(s),n({leaseFlag:s})},bt=()=>{const s=!nt;rt(s),n({loanedFlag:s})},i=s=>{s&&(vt==="assetNo"?(st(s),n({assetNo:s})):(ot(s),n({equipmentNo:s})))},S=s=>{Pt(s),dt(!0)},ue=o.useCallback(s=>{lt(`${s.targetLabel}を読み取り: ${s.text}`)},[]);o.useEffect(()=>{if(!He)return;const s=window.setTimeout(()=>lt(null),5e3);return()=>{window.clearTimeout(s)}},[He]);const be=f.length>0,[ge,ze]=o.useState([]),[Se,Ge]=o.useState([]),[Ce,Ke]=o.useState([]),[Ne,Ue]=o.useState([]),[ve,Te]=o.useState([]),[ke,Y]=o.useState(""),[me,Qe]=o.useState(""),[Tt,Ee]=o.useState(""),[Qt,ye]=o.useState(""),[Bt,ne]=o.useState(""),[us,Ht]=o.useState(""),[ms,$t]=o.useState(""),[hs,qt]=o.useState(""),[fs,Wt]=o.useState(""),[zt,Gt]=o.useState(!1),[Kt,ps]=o.useState([]),[Zt,gs]=o.useState(!1),[Nt,Vt]=o.useState(null),[Xt,Js]=o.useState("asc"),Yt=o.useRef(void 0),Jt=o.useRef(void 0),es=o.useRef(void 0),ts=o.useRef(void 0),ss=o.useRef(void 0);o.useEffect(()=>{Promise.all([w.product_categories.toArray(),w.product_subcategories.toArray(),w.product_items.toArray(),w.product_makers.toArray(),w.product_models.toArray()]).then(([s,u,q,te,Fe])=>{ze(s),Ge(u),Ke(q),Ue(te),Te(Fe)})},[]),o.useEffect(()=>{var s,u,q,te;Ht(((s=t==null?void 0:t.fields)==null?void 0:s.width)??""),$t(((u=t==null?void 0:t.fields)==null?void 0:u.depth)??""),qt(((q=t==null?void 0:t.fields)==null?void 0:q.height)??""),Wt(((te=t==null?void 0:t.fields)==null?void 0:te.note)??"")},[(Ls=t==null?void 0:t.fields)==null?void 0:Ls.width,(Ps=t==null?void 0:t.fields)==null?void 0:Ps.depth,(Us=t==null?void 0:t.fields)==null?void 0:Us.height,(Ts=t==null?void 0:t.fields)==null?void 0:Ts.note]);const Be=(Qs=t==null?void 0:t.fields)==null?void 0:Qs.categoryId,$e=(Bs=t==null?void 0:t.fields)==null?void 0:Bs.subcategoryId,Ze=(Hs=t==null?void 0:t.fields)==null?void 0:Hs.itemId,ct=($s=t==null?void 0:t.fields)==null?void 0:$s.makerId,wt=(qs=t==null?void 0:t.fields)==null?void 0:qs.modelId,_e=ge.find(s=>s.id===Be),Re=Se.find(s=>s.id===$e),Oe=Ce.find(s=>s.id===Ze),Ae=Ne.find(s=>s.id===ct),Me=ve.find(s=>s.id===wt);o.useEffect(()=>{(_e==null?void 0:_e.id)!==Yt.current&&(_e?Y(_e.name):Yt.current&&Y(""),Yt.current=_e==null?void 0:_e.id)},[_e]),o.useEffect(()=>{(Re==null?void 0:Re.id)!==Jt.current&&(Re?Qe(Re.name):Jt.current&&Qe(""),Jt.current=Re==null?void 0:Re.id)},[Re]),o.useEffect(()=>{(Oe==null?void 0:Oe.id)!==es.current&&(Oe?Ee(Oe.name):es.current&&Ee(""),es.current=Oe==null?void 0:Oe.id)},[Oe]),o.useEffect(()=>{(Ae==null?void 0:Ae.id)!==ts.current&&(Ae?ye(Ae.name):ts.current&&ye(""),ts.current=Ae==null?void 0:Ae.id)},[Ae]),o.useEffect(()=>{(Me==null?void 0:Me.id)!==ss.current&&(Me?ne(Me.name):ss.current&&ne(""),ss.current=Me==null?void 0:Me.id)},[Me]);const eo=o.useMemo(()=>ge.filter(s=>Pe(s.name,ke)),[ge,ke]),to=o.useMemo(()=>Se.filter(s=>Pe(s.name,me)),[Se,me]),so=o.useMemo(()=>Ce.filter(s=>Pe(s.name,Tt)),[Ce,Tt]),oo=o.useMemo(()=>Ne.filter(s=>Pe(s.name,Qt)),[Ne,Qt]),ao=o.useMemo(()=>ve.filter(s=>Pe(s.name,Bt)),[ve,Bt]),io=s=>{if(Be===s.id){Y(""),Qe(""),Ee(""),ye(""),ne(""),n({categoryId:void 0,subcategoryId:void 0,itemId:void 0,makerId:void 0,modelId:void 0});return}Y(s.name),Qe(""),Ee(""),ye(""),ne(""),n({categoryId:s.id,subcategoryId:void 0,itemId:void 0,makerId:void 0,modelId:void 0})},no=s=>{if($e===s.id){Qe(""),Ee(""),ye(""),ne(""),n({categoryId:Be??s.categoryId,subcategoryId:void 0,itemId:void 0,makerId:void 0,modelId:void 0});return}Qe(s.name),Ee(""),ye(""),ne(""),n({categoryId:s.categoryId,subcategoryId:s.id,itemId:void 0,makerId:void 0,modelId:void 0})},ro=s=>{if(Ze===s.id){Ee(""),ye(""),ne(""),n({categoryId:Be??s.categoryId,subcategoryId:$e??s.subcategoryId,itemId:void 0,makerId:void 0,modelId:void 0});return}Ee(s.name),ye(""),ne(""),n({categoryId:s.categoryId,subcategoryId:s.subcategoryId,itemId:s.id,makerId:void 0,modelId:void 0})},lo=s=>{if(ct===s.id){ye(""),ne(""),n({categoryId:Be??s.categoryId,subcategoryId:$e??s.subcategoryId,itemId:Ze??s.itemId,makerId:void 0,modelId:void 0});return}ye(s.name),ne(""),n({categoryId:s.categoryId,subcategoryId:s.subcategoryId,itemId:s.itemId,makerId:s.id,modelId:void 0})},co=s=>{if(wt===s.id){ne(""),n({categoryId:Be??s.categoryId,subcategoryId:$e??s.subcategoryId,itemId:Ze??s.itemId,makerId:ct??s.makerId,modelId:void 0});return}ne(s.name),n({categoryId:s.categoryId,subcategoryId:s.subcategoryId,itemId:s.itemId,makerId:s.makerId,modelId:s.id})},vs=o.useCallback(async s=>{gs(!0),Vt(null);try{const u=await m(s);ps(u)}catch(u){const q=u instanceof Error?u.message:String(u);Vt(q),ps([])}finally{gs(!1)}},[m]);o.useEffect(()=>{zt?vs(Xt):Vt(null)},[zt,Xt,vs]);const uo=s=>{const u=s.categoryId,q=s.subcategoryId,te=s.itemId,Fe=s.makerId,St=s.modelId,Ct=s.width!=null?String(s.width):"",kt=s.depth!=null?String(s.depth):"",Et=s.height!=null?String(s.height):"",Dt=s.note!=null?String(s.note):"";Ht(Ct),$t(kt),qt(Et),Wt(Dt);const ut=ge.find(Ie=>Ie.id===u),Ve=Se.find(Ie=>Ie.id===q),Xe=Ce.find(Ie=>Ie.id===te),Ye=Ne.find(Ie=>Ie.id===Fe),Je=ve.find(Ie=>Ie.id===St);Y((ut==null?void 0:ut.name)??""),Qe((Ve==null?void 0:Ve.name)??""),Ee((Xe==null?void 0:Xe.name)??""),ye((Ye==null?void 0:Ye.name)??""),ne((Je==null?void 0:Je.name)??""),n({categoryId:u,subcategoryId:q,itemId:te,makerId:Fe,modelId:St,width:Ct,depth:kt,height:Et,note:Dt})},mo=s=>{uo(s.fields??{}),Gt(!1)},ho=()=>{Js(s=>s==="asc"?"desc":"asc")},fo=async()=>{await l({preserveKeys:["surveyDate","investigator","buildingId","floorId","departmentId","divisionId"]})},po=!!(Be&&$e&&Ze&&ct&&wt)&&!!(us||ms||hs||fs);return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-section",children:[e.jsx("h2",{className:"section-title",children:"QR読取・基本情報"}),e.jsx("div",{className:"section-title-underline-blue"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["シールNo",e.jsx("input",{value:v,onChange:s=>xe(s.target.value),placeholder:"シールNoを入力"})]}),e.jsxs("label",{children:["室名",e.jsx("input",{value:J,onChange:s=>pe(s.target.value),placeholder:"室名を入力"}),K.length>0&&e.jsx("div",{className:"option-list",style:{marginTop:6},children:K.map(s=>e.jsx("button",{type:"button",onClick:()=>pe(s.name),children:s.name},s.id))})]})]}),e.jsx("div",{style:{marginTop:16},children:e.jsx(cs,{ref:De,onResult:ee})})]}),e.jsxs("div",{className:"page-section",children:[e.jsx("h2",{className:"section-title",children:"写真撮影・資産No登録"}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:tt,style:{display:"none"},onChange:s=>xt(s.target.files)}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["シールNo",e.jsx("input",{value:yt,disabled:!0})]}),e.jsxs("label",{children:["室名",e.jsx("input",{value:It,disabled:!0})]}),e.jsxs("label",{children:["資産番号",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:At,onChange:s=>{const u=s.target.value;st(u),n({assetNo:u})}}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:()=>S("assetNo"),children:"読み取り"})]})]}),e.jsxs("label",{children:["備品番号",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:Mt,onChange:s=>{const u=s.target.value;ot(u),n({equipmentNo:u})}}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:()=>S("equipmentNo"),children:"読み取り"})]})]}),e.jsxs("label",{children:["購入年月日",e.jsx("input",{type:"date",value:Ft,onChange:s=>{const u=s.target.value;at(u),n({purchaseDate:u})}})]}),e.jsxs("div",{className:"row",children:[e.jsxs("button",{type:"button",className:it?"secondary":"ghost",onClick:jt,children:["リース: ",it?"ON":"OFF"]}),e.jsxs("button",{type:"button",className:nt?"secondary":"ghost",onClick:bt,children:["貸出品: ",nt?"ON":"OFF"]})]})]}),e.jsx("div",{className:"photo-strip",children:We.map(s=>e.jsxs("div",{className:"photo-item",children:[e.jsx("button",{type:"button",className:"photo-remove",onClick:()=>y(s.id),"aria-label":"写真を削除",children:"×"}),e.jsx("img",{src:s.url,alt:"サムネイル"})]},s.id))}),He&&e.jsx("div",{className:"ocr-result-banner",children:He})]}),e.jsxs("div",{className:"page-section",children:[e.jsx("h2",{className:"section-title",children:"商品登録"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["大分類",e.jsx("input",{value:ke,onChange:s=>Y(s.target.value),placeholder:"大分類を検索"})]}),e.jsx("div",{className:"option-list",children:eo.map(s=>e.jsx("button",{onClick:()=>io(s),className:s.id===Be?"active":"",children:s.name},s.id))}),e.jsxs("label",{children:["中分類",e.jsx("input",{value:me,onChange:s=>Qe(s.target.value),placeholder:"中分類を検索"})]}),e.jsx("div",{className:"option-list",children:to.map(s=>e.jsx("button",{onClick:()=>no(s),className:s.id===$e?"active":"",children:s.name},s.id))}),e.jsxs("label",{children:["品目",e.jsx("input",{value:Tt,onChange:s=>Ee(s.target.value),placeholder:"品目を検索"})]}),e.jsx("div",{className:"option-list",children:so.map(s=>e.jsx("button",{onClick:()=>ro(s),className:s.id===Ze?"active":"",children:s.name},s.id))}),e.jsxs("label",{children:["メーカー名",e.jsx("input",{value:Qt,onChange:s=>ye(s.target.value),placeholder:"メーカー名を検索"})]}),e.jsx("div",{className:"option-list",children:oo.map(s=>e.jsx("button",{onClick:()=>lo(s),className:s.id===ct?"active":"",children:s.name},s.id))}),e.jsxs("label",{children:["型式",e.jsx("input",{value:Bt,onChange:s=>ne(s.target.value),placeholder:"型式を検索"})]}),e.jsx("div",{className:"option-list",children:ao.map(s=>e.jsx("button",{onClick:()=>co(s),className:s.id===wt?"active":"",children:s.name},s.id))})]}),e.jsxs("div",{className:"grid",style:{marginTop:16},children:[e.jsxs("label",{children:["W",e.jsx("input",{value:us,onChange:s=>{const u=s.target.value;Ht(u),n({width:u})},placeholder:"mm"})]}),e.jsxs("label",{children:["D",e.jsx("input",{value:ms,onChange:s=>{const u=s.target.value;$t(u),n({depth:u})},placeholder:"mm"})]}),e.jsxs("label",{children:["H",e.jsx("input",{value:hs,onChange:s=>{const u=s.target.value;qt(u),n({height:u})},placeholder:"mm"})]}),e.jsxs("label",{children:["備考",e.jsx("textarea",{value:fs,onChange:s=>{const u=s.target.value;Wt(u),n({note:u})},rows:3})]})]}),e.jsx("div",{className:"row",style:{justifyContent:"flex-start",marginTop:8},children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>Gt(!0),children:"履歴表示"})})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>gt(!0),children:"複製"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>d("/survey/home"),children:"ホーム"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>d("/survey/department"),children:"部門"}),e.jsx("button",{type:"button",onClick:fo,disabled:!(we&&je&&be&&po),children:"次の資産へ"})]}),e.jsx(Ot,{open:Lt,onClose:()=>gt(!1)}),e.jsx(Ys,{open:Ut,targetLabel:vt==="assetNo"?"資産番号":"備品番号",onClose:()=>dt(!1),onResult:i,onRecognized:ue}),zt&&e.jsx("div",{className:"history-overlay",children:e.jsxs("div",{className:"history-panel",children:[e.jsxs("div",{className:"history-header",children:[e.jsx("h3",{children:"作業履歴"}),e.jsxs("div",{className:"row",children:[e.jsx("button",{className:"ghost",onClick:ho,children:Xt==="asc"?"降順にする":"昇順にする"}),e.jsx("button",{className:"ghost",onClick:()=>Gt(!1),children:"閉じる"})]})]}),Zt&&e.jsx("p",{className:"helper-text",children:"読み込み中..."}),Nt&&e.jsxs("p",{className:"badge warn",children:["エラー: ",Nt]}),!Zt&&!Nt&&Kt.length===0&&e.jsx("p",{className:"helper-text",children:"表示できる履歴がありません。"}),!Zt&&!Nt&&Kt.length>0&&e.jsx("div",{className:"history-list",children:Kt.map(s=>{var Ve,Xe,Ye,Je,Ie;const u=s.fields??{},q=u.completedAt??s.updatedAt,te=((Ve=ge.find(Le=>Le.id===u.categoryId))==null?void 0:Ve.name)??"-",Fe=((Xe=Se.find(Le=>Le.id===u.subcategoryId))==null?void 0:Xe.name)??"-",St=((Ye=Ce.find(Le=>Le.id===u.itemId))==null?void 0:Ye.name)??"-",Ct=((Je=Ne.find(Le=>Le.id===u.makerId))==null?void 0:Je.name)??"-",kt=((Ie=ve.find(Le=>Le.id===u.modelId))==null?void 0:Ie.name)??"-",Et=u.width??"-",Dt=u.depth??"-",ut=u.height??"-";return e.jsxs("button",{type:"button",className:"history-row",onClick:()=>mo(s),children:[e.jsxs("div",{className:"history-meta",children:[e.jsx("span",{children:new Date(q).toLocaleString()}),u.assetNo&&e.jsxs("span",{className:"pill",children:["資産 ",u.assetNo]}),u.equipmentNo&&e.jsxs("span",{className:"pill",children:["備品 ",u.equipmentNo]}),u.sealNo&&e.jsxs("span",{className:"pill",children:["QR ",u.sealNo]})]}),e.jsxs("div",{className:"history-tags",children:[e.jsx("span",{className:"pill",children:te}),e.jsx("span",{className:"pill",children:Fe}),e.jsx("span",{className:"pill",children:St}),e.jsx("span",{className:"pill",children:Ct}),e.jsx("span",{className:"pill",children:kt})]}),e.jsx("div",{className:"history-meta",children:e.jsxs("span",{children:["W:",Et," / D:",Dt," / H:",ut]})})]},s.id)})})]})})]})}export{Wo as A,Bo as D,Ho as L,zo as P,oa as S,Xo as a,Yo as b,ea as c,w as d,ko as e,ta as f,sa as g,Xs as p,Jo as q,qe as u,Po as w};
