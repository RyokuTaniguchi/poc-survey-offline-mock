var Ko=Object.defineProperty;var Zo=(u,a,s)=>a in u?Ko(u,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[a]=s;var Se=(u,a,s)=>Zo(u,typeof a!="symbol"?a+"":a,s);import{i as co,c as Vo,r as o,s as fo,u as Rt,j as e}from"./vendor-5jQwBCrV.js";import{B as fs}from"./vendor-zxing-DcYOnkv9.js";import{D as Xo}from"./vendor-dexie-DWlydIdn.js";class Yo extends Xo{constructor(){super("meddx_survey");Se(this,"survey_drafts");Se(this,"survey_photos");Se(this,"survey_masters");Se(this,"indices");Se(this,"settings");Se(this,"location_buildings");Se(this,"location_floors");Se(this,"location_departments");Se(this,"location_divisions");Se(this,"product_categories");Se(this,"product_subcategories");Se(this,"product_items");Se(this,"product_makers");Se(this,"product_models");Se(this,"location_rooms");this.version(1).stores({survey_drafts:"id,updatedAt,qr",survey_photos:"id,draftId,createdAt",survey_masters:"id,updatedAt,nameNfkc,makerNfkc,model",indices:"id",settings:"key"}),this.version(2).stores({survey_drafts:"id,updatedAt,qr",survey_photos:"id,draftId,createdAt",survey_masters:"id,updatedAt,nameNfkc,makerNfkc,model",indices:"id",settings:"key",location_buildings:"id,name",location_floors:"id,buildingId,name",location_departments:"id,buildingId,floorId,name",location_divisions:"id,buildingId,floorId,departmentId,name",product_categories:"id,name",product_subcategories:"id,categoryId,name",product_items:"id,categoryId,subcategoryId,name",product_makers:"id,categoryId,subcategoryId,itemId,name",product_models:"id,categoryId,subcategoryId,itemId,makerId,name"}),this.version(3).stores({survey_drafts:"id,updatedAt,qr",survey_photos:"id,draftId,createdAt",survey_masters:"id,updatedAt,nameNfkc,makerNfkc,model",indices:"id",settings:"key",location_buildings:"id,name",location_floors:"id,buildingId,name",location_departments:"id,buildingId,floorId,name",location_divisions:"id,buildingId,floorId,departmentId,name",product_categories:"id,name",product_subcategories:"id,categoryId,name",product_items:"id,categoryId,subcategoryId,name",product_makers:"id,categoryId,subcategoryId,itemId,name",product_models:"id,categoryId,subcategoryId,itemId,makerId,name",location_rooms:"id,buildingId,floorId,departmentId,divisionId,name"})}}const S=new Yo,Jo="/poc-survey-offline-mock/".replace(/\/?$/,"/"),uo=`${Jo}vendor/browser-image-compression.js`;async function ea(u,a=2560){const v=await co(u,{maxWidthOrHeight:a,initialQuality:.7,fileType:"image/webp",useWebWorker:!0,libURL:uo}),k=await co(u,{maxWidthOrHeight:512,initialQuality:.7,fileType:"image/webp",useWebWorker:!0,libURL:uo});return{blob:v,thumb:k}}const ft=Vo((u,a)=>{const s=async()=>{const r=a().current;if(!r){u({photos:[]});return}const c=await S.survey_photos.where("draftId").equals(r.id).reverse().toArray();u({photos:c})},v=async()=>{const r=await S.survey_drafts.filter(c=>{var h;return((h=c.fields)==null?void 0:h.status)==="completed"}).count();u({completedCount:r})},k=async r=>{await S.survey_drafts.put(r),u({current:r}),await v()},w={current:void 0,photos:[],completedCount:0,async newDraft(){const r=crypto.randomUUID(),c={id:r,fields:{},photoIds:[],updatedAt:Date.now()};return await S.survey_drafts.put(c),u({current:c}),setTimeout(()=>{s()},0),await v(),r},async load(r){let c=await S.survey_drafts.get(r);c||(c={id:r,fields:{},photoIds:[],updatedAt:Date.now()},await S.survey_drafts.put(c)),u({current:c}),await s(),await v()},async setField(r,c){const h=a().current;if(!h)return;const f={...h.fields};c==null||c===""?delete f[r]:f[r]=c;const N={...h,fields:f,updatedAt:Date.now()};await k(N)},async setFields(r){const c=a().current;if(!c)return;const h={...c.fields};Object.entries(r).forEach(([N,A])=>{A==null||A===""?delete h[N]:h[N]=A});const f={...c,fields:h,updatedAt:Date.now()};await k(f)},async setQR(r){const c=a().current;if(!c)return;const h={...c,qr:r,fields:{...c.fields,sealNo:r,qrCode:r},updatedAt:Date.now()};await k(h)},async attachPhoto(r){const c=a().current;if(!c)return;const{blob:h,thumb:f}=await ea(r),N=await S.survey_photos.where("draftId").equals(c.id).count(),A={id:crypto.randomUUID(),draftId:c.id,blob:h,thumb:f,size:h.size,createdAt:Date.now(),selectedForList:N===0};await S.survey_photos.put(A);const C={...c,photoIds:[...c.photoIds,A.id],updatedAt:Date.now()};await k(C),await s()},async togglePhotoForList(r){const c=a().current;if(!c)return;const h=await S.survey_photos.get(r),f=!(h!=null&&h.selectedForList);await S.survey_photos.where("draftId").equals(c.id).modify(N=>{N.selectedForList=f&&N.id===r}),await s()},async removePhoto(r){const c=a().current;if(!c)return;await S.survey_photos.delete(r);const h=c.photoIds.filter(N=>N!==r),f={...c,photoIds:h,updatedAt:Date.now()};await k(f),await s()},async refreshPhotos(){await s()},async refreshStats(){await v()},async completeCurrent(r){const c=a().current;if(!c)return;const h={...c,fields:{...c.fields,status:"completed",completedAt:Date.now()},updatedAt:Date.now()};await k(h),await s();const f=await a().newDraft();await s();const N=(r==null?void 0:r.preserveKeys)??[];if(N.length>0){const A={};N.forEach(C=>{var Q;((Q=c.fields)==null?void 0:Q[C])!==void 0&&(A[C]=c.fields[C])}),Object.keys(A).length>0&&await a().setFields(A)}return f},async clearCurrent(){const r=a().current;r&&(await S.survey_photos.where("draftId").equals(r.id).delete(),await S.survey_drafts.delete(r.id),u({current:void 0,photos:[]}),await v())},async listHistory(r="asc"){const c=S.survey_drafts.orderBy("updatedAt");return(r==="desc"?await c.reverse().toArray():await c.toArray()).filter(f=>{var N;return((N=f.fields)==null?void 0:N.status)==="completed"})},async purgeCompleted(){const r=await S.survey_drafts.filter(h=>{var f;return((f=h.fields)==null?void 0:f.status)==="completed"}).toArray();if(r.length===0)return 0;await S.transaction("rw",S.survey_drafts,S.survey_photos,async()=>{for(const h of r)await S.survey_photos.where("draftId").equals(h.id).delete(),await S.survey_drafts.delete(h.id)});const c=a().current;return c&&r.some(h=>h.id===c.id)&&u({current:void 0,photos:[]}),await v(),await s(),r.length},async duplicateDraft(r,c){if(c<=0)return 0;const h=await S.survey_drafts.get(r);if(!h)throw new Error("複製元の履歴が見つかりません");const f={...h.fields??{}},N=f.sealNo||f.qr||f.qrCode||h.qr;if(!N)throw new Error("複製元のQRコードが取得できませんでした");const A=N.match(/(\d+)(?!.*\d)/),C=A?A.index??-1:-1,Q=A?parseInt(A[1],10):null,R=A?A[1].length:0,z=C>=0?N.slice(0,C):N,M=C>=0?N.slice(C+R):"",J=await S.survey_photos.where("draftId").equals(r).toArray(),E=[],T=[],D=Date.now(),$=x=>{if(Q!==null){const p=Q+x,H=String(p).padStart(R,"0");return`${z}${H}${M}`}return`${N}-${x}`};for(let x=1;x<=c;x++){const p=crypto.randomUUID(),H=$(x),B=[],b={...f,qr:H,qrCode:H,sealNo:H,status:"completed",completedAt:D+x};J.forEach(_=>{const q=crypto.randomUUID();B.push(q),T.push({..._,id:q,draftId:p,createdAt:D+x})}),E.push({id:p,fields:b,photoIds:B,updatedAt:D+x})}await S.transaction("rw",S.survey_drafts,S.survey_photos,async()=>{T.length>0&&await S.survey_photos.bulkPut(T),E.length>0&&await S.survey_drafts.bulkPut(E)}),await v();const L=a().current;if(L){const x=await S.survey_drafts.get(L.id);x&&u({current:x})}return E.length}};return v(),w});function Ft(){const{current:u,newDraft:a}=ft();o.useEffect(()=>{u||a()},[u,a])}const ta="この端末ではカメラが利用できません",sa="ブラウザ環境ではありません",oa="カメラの利用には HTTPS での接続が必要です";function aa(){if(typeof navigator>"u")return null;const u=navigator.mediaDevices;if(u!=null&&u.getUserMedia)return s=>u.getUserMedia(s);const a=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return a?s=>new Promise((v,k)=>{a.call(navigator,s,v,k)}):null}async function ts(){if(typeof navigator>"u")throw new Error(sa);if(typeof window<"u"&&"isSecureContext"in window&&!window.isSecureContext)throw new Error(oa);const u=aa();if(!u)throw new Error(ta);if(sessionStorage.getItem("cameraPermission")==="granted")return"granted";try{return(await u({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}},audio:!1})).getTracks().forEach(v=>v.stop()),sessionStorage.setItem("cameraPermission","granted"),"granted"}catch(s){const v=s;throw(v==null?void 0:v.name)==="NotAllowedError"||(v==null?void 0:v.name)==="SecurityError"?sessionStorage.setItem("cameraPermission","denied"):sessionStorage.removeItem("cameraPermission"),s instanceof Error?s:new Error(String(s))}}const gs={},na="/poc-survey-offline-mock/".replace(/\/?$/,"/"),vs=u=>`${na}tesseract/${u.replace(/^\//,"")}`;var ho;const ia=(ho=gs==null?void 0:gs.VITE_TESSDATA_URL)==null?void 0:ho.trim(),ra=vs("lang-data/"),go=(ia??ra).replace(/\/?$/,"/");let Dt=null,ys=!1;const da=6e4;function la(u,a,s){return new Promise((v,k)=>{const w=setTimeout(()=>{try{s==null||s()}catch{}k(new Error("OCR処理がタイムアウトしました"))},a);u.then(r=>{clearTimeout(w),v(r)},r=>{clearTimeout(w),k(r)})})}function ca(u){return u.replace(/[\uFF01-\uFF5E]/g,a=>String.fromCharCode(a.charCodeAt(0)-65248)).replace(/\u3000/g," ")}function ua(u){return ca(u).toUpperCase().replace(/[\u2010-\u2015\u2212\u30FC\uFF0D\uFE63]/g,"-").replace(/[^0-9A-Z-]/g,"")}const Is=()=>{Dt=null,ys=!1};async function ma(){return fo.createWorker("eng",void 0,{workerPath:vs("worker.min.js"),corePath:vs("tesseract-core.wasm.js"),langPath:go,workerBlobURL:!1})}async function xs(){Dt||(Dt=la(ma(),da,Is));try{const u=await Dt;return ys||(await u.setParameters({tessedit_char_whitelist:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-",tessedit_pageseg_mode:fo.PSM.SINGLE_LINE}),ys=!0),u}catch(u){throw Is(),u instanceof Error?u:new Error("Tesseract workerの初期化に失敗しました")}}function po(){xs().catch(()=>{})}const ha=["tesseract/lang-data/eng.traineddata.gz","tesseract/worker.min.js","tesseract/tesseract-core.wasm","tesseract/tesseract-core.wasm.js"];async function fa(){const u="/poc-survey-offline-mock/".replace(/\/?$/,"/");await Promise.all(ha.map(async a=>{try{await fetch(`${u}${a}`,{cache:"force-cache"})}catch{}}))}async function Ea(){await fa(),await xs()}async function ga(u){const a=await xs(),{data:s}=await a.recognize(u).catch(async h=>{throw await pa(),h}),v=Array.isArray(s.lines)?s.lines:[],k=v.map(h=>{var f,N;return((N=(f=h.text)==null?void 0:f.trim)==null?void 0:N.call(f))??""}).filter(Boolean),w=v.reduce((h,f)=>!h||f.confidence>h.confidence?{text:f.text,confidence:f.confidence}:h,null),r=ua((w==null?void 0:w.text)??s.text??""),c=(w==null?void 0:w.confidence)??s.confidence??0;return{text:r,rawText:s.text??"",candidates:k.length>0?k:(s.text??"").split(/\n+/).map(h=>h.trim()).filter(Boolean),confidence:c,method:"tesseract"}}async function pa(){if(!Dt)return;await(await Dt).terminate(),Is()}async function va(u){let a=null;try{return await ga(u)}catch(s){a=s instanceof Error?s:new Error(String(s))}if(a){const s=a.message;throw go.startsWith("http")?typeof navigator<"u"&&!navigator.onLine?new Error("OCR辞書データが未取得です。オンライン接続時に一度読み取りを実行し、キャッシュを作成してください。"):new Error(`OCR辞書データのダウンロードに失敗しました: ${s}`):new Error(`OCR辞書データの読み込みに失敗しました。詳細: ${s}`)}throw new Error("OCR処理に失敗しました。")}function Jt(u,a){return a?u.toLowerCase().includes(a.toLowerCase()):!0}function ya(){var we,ge,Me,be,de,ce;Ft();const u=Rt(),{current:a,setFields:s}=ft(),[v,k]=o.useState([]),[w,r]=o.useState([]),[c,h]=o.useState([]),[f,N]=o.useState([]),[A,C]=o.useState(""),[Q,R]=o.useState(""),[z,M]=o.useState(""),[J,E]=o.useState(""),[T,D]=o.useState(void 0),[$,L]=o.useState(void 0),[x,p]=o.useState(void 0),[H,B]=o.useState(void 0),b=o.useMemo(()=>{const d=new Date;return`${d.getFullYear()}年${String(d.getMonth()+1).padStart(2,"0")}月${String(d.getDate()).padStart(2,"0")}日`},[]),_=typeof window<"u"?sessionStorage.getItem("mockUserEmail")??"":"";o.useEffect(()=>{sessionStorage.setItem("visitedDepartment","1")},[]),o.useEffect(()=>{Promise.all([S.location_buildings.toArray(),S.location_floors.toArray(),S.location_departments.toArray(),S.location_divisions.toArray()]).then(([d,W,ee,Y])=>{k(d),r(W),h(ee),N(Y)})},[]),o.useEffect(()=>{var W,ee;if(!a)return;const d={};(W=a.fields)!=null&&W.surveyDate||(d.surveyDate=b),_&&((ee=a.fields)==null?void 0:ee.investigator)!==_&&(d.investigator=_),Object.keys(d).length>0&&s(d)},[a,_,s,b]);const q=(we=a==null?void 0:a.fields)==null?void 0:we.buildingId,g=(ge=a==null?void 0:a.fields)==null?void 0:ge.floorId,F=(Me=a==null?void 0:a.fields)==null?void 0:Me.departmentId,V=(be=a==null?void 0:a.fields)==null?void 0:be.divisionId;o.useEffect(()=>{D(q)},[q]),o.useEffect(()=>{L(g)},[g]),o.useEffect(()=>{p(F)},[F]),o.useEffect(()=>{B(V)},[V]);const G=o.useMemo(()=>v.find(d=>d.id===T),[v,T]),K=o.useMemo(()=>w.find(d=>d.id===$),[w,$]),oe=o.useMemo(()=>c.find(d=>d.id===x),[c,x]),ae=o.useMemo(()=>f.find(d=>d.id===H),[f,H]);o.useEffect(()=>{C(G?G.name:"")},[G]),o.useEffect(()=>{R(K?K.name:"")},[K]),o.useEffect(()=>{M(oe?oe.name:"")},[oe]),o.useEffect(()=>{E(ae?ae.name:"")},[ae]);const le=o.useMemo(()=>v.filter(d=>Jt(d.name,A)),[v,A]),xe=o.useMemo(()=>w.filter(d=>T&&d.buildingId!==T?!1:Jt(d.name,Q)),[w,Q,T]),ne=o.useMemo(()=>c.filter(d=>T&&d.buildingId!==T||$&&d.floorId!==$?!1:Jt(d.name,z)),[c,z,T,$]),Ne=o.useMemo(()=>f.filter(d=>T&&d.buildingId!==T||$&&d.floorId!==$||x&&d.departmentId!==x?!1:Jt(d.name,J)),[f,J,T,$,x]),ie=d=>{if(!d||T===d.id){C(""),R(""),M(""),E(""),D(void 0),L(void 0),p(void 0),B(void 0),s({buildingId:void 0,floorId:void 0,departmentId:void 0,divisionId:void 0});return}C(d.name),R(""),M(""),E(""),D(d.id),L(void 0),p(void 0),B(void 0),s({buildingId:d.id,floorId:void 0,departmentId:void 0,divisionId:void 0})},ve=d=>{if(!d||$===d.id){R(""),M(""),E(""),L(void 0),p(void 0),B(void 0),s({buildingId:T,floorId:void 0,departmentId:void 0,divisionId:void 0});return}const W=v.find(ee=>ee.id===d.buildingId);W&&(C(W.name),D(W.id)),R(d.name),M(""),E(""),L(d.id),p(void 0),B(void 0),s({buildingId:d.buildingId,floorId:d.id,departmentId:void 0,divisionId:void 0})},re=d=>{if(!d||x===d.id){M(""),E(""),p(void 0),B(void 0),s({buildingId:T,floorId:$,departmentId:void 0,divisionId:void 0});return}const W=v.find(Y=>Y.id===d.buildingId),ee=w.find(Y=>Y.id===d.floorId);W&&(C(W.name),D(W.id)),ee&&(R(ee.name),L(ee.id)),M(d.name),E(""),p(d.id),B(void 0),s({buildingId:d.buildingId,floorId:d.floorId,departmentId:d.id,divisionId:void 0})},j=d=>{if(!d||H===d.id){E(""),B(void 0),s({buildingId:T,floorId:$,departmentId:x,divisionId:void 0});return}const W=v.find(X=>X.id===d.buildingId),ee=w.find(X=>X.id===d.floorId),Y=c.find(X=>X.id===d.departmentId);W&&(C(W.name),D(W.id)),ee&&(R(ee.name),L(ee.id)),Y&&(M(Y.name),p(Y.id)),E(d.name),B(d.id),s({buildingId:d.buildingId,floorId:d.floorId,departmentId:d.departmentId,divisionId:d.id})},U=!!(T&&$&&x&&H);return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-section",children:[e.jsx("h2",{className:"section-title",children:"部署入力"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["調査日",e.jsx("input",{value:((de=a==null?void 0:a.fields)==null?void 0:de.surveyDate)??b,disabled:!0})]}),e.jsxs("label",{children:["調査担当",e.jsx("input",{value:((ce=a==null?void 0:a.fields)==null?void 0:ce.investigator)??_,disabled:!0})]})]}),e.jsxs("div",{className:"grid",style:{marginTop:16},children:[e.jsxs("label",{children:["棟",e.jsx("input",{value:A,onChange:d=>C(d.target.value),placeholder:"棟を検索"})]}),e.jsx("div",{className:"option-list",children:le.map(d=>e.jsx("button",{onClick:()=>ie(d),className:d.id===T?"active":"",children:d.name},d.id))}),e.jsxs("label",{children:["階",e.jsx("input",{value:Q,onChange:d=>R(d.target.value),placeholder:"階を検索"})]}),e.jsx("div",{className:"option-list",children:xe.map(d=>{var W;return e.jsxs("button",{onClick:()=>ve(d),className:d.id===$?"active":"",children:[d.name,"（",((W=v.find(ee=>ee.id===d.buildingId))==null?void 0:W.name)??"","）"]},d.id)})}),e.jsxs("label",{children:["部署",e.jsx("input",{value:z,onChange:d=>M(d.target.value),placeholder:"部署を検索"})]}),e.jsx("div",{className:"option-list",children:ne.map(d=>e.jsx("button",{onClick:()=>re(d),className:d.id===x?"active":"",children:d.name},d.id))}),e.jsxs("label",{children:["部門",e.jsx("input",{value:J,onChange:d=>E(d.target.value),placeholder:"部門を検索"})]}),e.jsx("div",{className:"option-list",children:Ne.map(d=>e.jsx("button",{onClick:()=>j(d),className:d.id===H?"active":"",children:d.name},d.id))})]}),e.jsx("p",{className:"helper-text",children:"今日一日がんばって！！"})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{className:"ghost",onClick:()=>u("/home"),children:"ホーム"}),e.jsx("button",{onClick:()=>u("/survey/all"),disabled:!U,children:"次へ"})]})]})}const Oa=Object.freeze(Object.defineProperty({__proto__:null,default:ya},Symbol.toStringTag,{value:"Module"})),Ns=o.forwardRef(({onResult:u},a)=>{const s=o.useRef(null),v=o.useRef(null),k=o.useRef(null),[w,r]=o.useState(!1);o.useEffect(()=>(v.current=new fs,()=>{var f;(f=k.current)==null||f.stop(),k.current=null,fs.releaseAllStreams(),v.current=null,r(!1)}),[]);const c=o.useCallback(()=>{var f;(f=k.current)==null||f.stop(),k.current=null,fs.releaseAllStreams(),r(!1)},[]),h=o.useCallback(async()=>{if(!(!s.current||!v.current)&&!w){r(!0);try{k.current=await v.current.decodeFromConstraints({video:{facingMode:"environment"}},s.current,f=>{f&&(u(f.getText()),c())})}catch(f){console.error(f),r(!1),k.current=null}}},[u,w,c]);return o.useImperativeHandle(a,()=>({start:h,stop:c}),[h,c]),e.jsxs("div",{className:"qr-container",style:{display:w?"block":"none"},children:[e.jsx("video",{ref:s,className:"qr-video",muted:!0,playsInline:!0}),w&&e.jsx("div",{className:"helper-text",style:{marginTop:8},children:"読み取り中です..."})]})}),Ma=Object.freeze(Object.defineProperty({__proto__:null,QRScanner:Ns},Symbol.toStringTag,{value:"Module"}));function bs({open:u,onClose:a}){const{listHistory:s,duplicateDraft:v}=ft(),[k,w]=o.useState("asc"),[r,c]=o.useState(!1),[h,f]=o.useState(null),[N,A]=o.useState([]),[C,Q]=o.useState(null),[R,z]=o.useState({}),[M,J]=o.useState(null),E=async x=>{c(!0),f(null);try{const p=await s(x);A(p)}catch(p){const H=p instanceof Error?p.message:String(p);f(H),A([])}finally{c(!1)}};o.useEffect(()=>{u?(Q(null),z({}),J(null),E(k)):(f(null),A([]))},[u,k]);const T=()=>{w(x=>x==="asc"?"desc":"asc")},D=(x,p)=>{z(H=>({...H,[x]:p}))},$=async x=>{const p=R[x]??"1",H=Number.parseInt(p,10);if(!Number.isFinite(H)||H<=0){Q("複製数は1以上の整数を入力してください");return}J(x),Q(null);try{const B=await v(x,H);Q(`履歴を ${B} 件複製しました`),z(b=>({...b,[x]:""})),await E(k)}catch(B){const b=B instanceof Error?B.message:String(B);Q(`複製に失敗しました: ${b}`)}finally{J(null)}},L=o.useMemo(()=>r?e.jsx("p",{className:"helper-text",children:"読み込み中..."}):h?e.jsxs("p",{className:"badge warn",children:["エラー: ",h]}):N.length===0?e.jsx("p",{className:"helper-text",children:"複製可能な履歴がありません。"}):N.map(x=>{const p=x.fields??{},H=p.completedAt??x.updatedAt,B=p.sealNo??p.qr??x.qr??"-",b=p.assetNo??"-",_=p.equipmentNo??"-",q=p.width??"-",g=p.depth??"-",F=p.height??"-",V=p.note??"",G=R[x.id]??"";return e.jsxs("div",{className:"history-row static",children:[e.jsxs("div",{className:"history-meta",children:[e.jsx("span",{children:new Date(H).toLocaleString()}),e.jsxs("span",{className:"pill",children:["QR ",B]}),b!=="-"&&e.jsxs("span",{className:"pill",children:["資産 ",b]}),_!=="-"&&e.jsxs("span",{className:"pill",children:["備品 ",_]})]}),e.jsxs("div",{className:"history-tags",children:[e.jsxs("span",{className:"pill",children:["Category ",p.categoryId??"-"]}),e.jsxs("span",{className:"pill",children:["Sub ",p.subcategoryId??"-"]}),e.jsxs("span",{className:"pill",children:["Item ",p.itemId??"-"]}),e.jsxs("span",{className:"pill",children:["Maker ",p.makerId??"-"]}),e.jsxs("span",{className:"pill",children:["Model ",p.modelId??"-"]})]}),e.jsxs("div",{className:"history-meta",children:[e.jsxs("span",{children:["W: ",q]}),e.jsxs("span",{children:["D: ",g]}),e.jsxs("span",{children:["H: ",F]}),V&&e.jsxs("span",{children:["備考: ",V]})]}),e.jsxs("div",{className:"history-duplicate",children:[e.jsx("input",{type:"number",min:1,placeholder:"複製数",value:G,onChange:K=>D(x.id,K.target.value)}),e.jsx("button",{type:"button",className:"secondary",onClick:()=>$(x.id),disabled:M===x.id,children:M===x.id?"複製中...":"複製"})]})]},x.id)}),[N,R,r,h,M]);return u?e.jsx("div",{className:"history-overlay",children:e.jsxs("div",{className:"history-panel",children:[e.jsxs("div",{className:"history-header",children:[e.jsx("h3",{children:"複製"}),e.jsxs("div",{className:"row",children:[e.jsx("button",{className:"ghost",onClick:T,children:k==="asc"?"降順にする":"昇順にする"}),e.jsx("button",{className:"ghost",onClick:a,children:"閉じる"})]})]}),C&&e.jsx("p",{className:"badge success",style:{marginTop:8},children:C}),e.jsx("div",{className:"history-list",children:L})]})}):null}function Ia(){var p,H,B,b,_,q;Ft();const u=Rt(),a=o.useRef(null),{current:s,setFields:v,setQR:k}=ft(),[w,r]=o.useState(""),[c,h]=o.useState(""),[f,N]=o.useState([]),[A,C]=o.useState(!1);o.useEffect(()=>{var g,F;r(((g=s==null?void 0:s.fields)==null?void 0:g.sealNo)??""),h(((F=s==null?void 0:s.fields)==null?void 0:F.roomName)??"")},[(p=s==null?void 0:s.fields)==null?void 0:p.sealNo,(H=s==null?void 0:s.fields)==null?void 0:H.roomName]),o.useEffect(()=>()=>{var g;(g=a.current)==null||g.stop()},[]),o.useEffect(()=>{let g=!0;return S.location_rooms.toArray().then(F=>{g&&N(F)}).catch(()=>{g&&N([])}),()=>{g=!1}},[]);const Q=(B=s==null?void 0:s.fields)==null?void 0:B.buildingId,R=(b=s==null?void 0:s.fields)==null?void 0:b.floorId,z=(_=s==null?void 0:s.fields)==null?void 0:_.departmentId,M=(q=s==null?void 0:s.fields)==null?void 0:q.divisionId,J=o.useMemo(()=>{if(!Q||!R||!z||!M)return[];const g=c.trim().toLowerCase();return f.filter(F=>F.buildingId!==Q||F.floorId!==R||F.departmentId!==z||F.divisionId!==M?!1:g?F.name.toLowerCase().includes(g):!0)},[f,Q,R,z,M,c]),E=g=>{const F=g.trim(),V=F.match(/medical-record\/([A-Za-z0-9-]+)$/i),G=V?V[1]:F;r(G),k(G)},T=g=>{r(g),v({sealNo:g,qrCode:g})},D=g=>{h(g),v({roomName:g})},$=()=>{var g;(g=a.current)==null||g.stop(),u("/survey/department")},L=()=>{var g;(g=a.current)==null||g.stop(),u("/survey/asset")},x=!!(w.trim()&&c.trim());return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-section",children:[e.jsx("h2",{className:"section-title",children:"QRコード読取・ラベルNo確認"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["シールNo",e.jsx("input",{value:w,onChange:g=>T(g.target.value),placeholder:"シールNoを入力"})]}),e.jsxs("label",{children:["室名",e.jsx("input",{value:c,onChange:g=>D(g.target.value),placeholder:"室名を入力"}),J.length>0&&e.jsx("div",{className:"option-list",style:{marginTop:6},children:J.map(g=>e.jsx("button",{type:"button",onClick:()=>D(g.name),children:g.name},g.id))})]})]}),e.jsx("div",{style:{marginTop:16},children:e.jsx(Ns,{ref:a,onResult:E})})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{className:"ghost",onClick:()=>C(!0),children:"複製"}),e.jsx("button",{className:"ghost",onClick:$,children:"戻る"}),e.jsx("button",{className:"secondary",onClick:async()=>{var g;try{await ts(),await((g=a.current)==null?void 0:g.start())}catch(F){const V=F instanceof Error?F.message:String(F);alert(`カメラを利用できませんでした: ${V}`)}},children:"QR撮影"}),e.jsx("button",{onClick:L,disabled:!x,children:"次へ"})]}),e.jsx(bs,{open:A,onClose:()=>C(!1)})]})}const _a=Object.freeze(Object.defineProperty({__proto__:null,default:Ia},Symbol.toStringTag,{value:"Module"})),es={left:.08,top:.425,width:.84,height:.15},mo=1200,xa=2e3;function ps(u,a){const s=u.split(","),v=s[0].match(/:(.*?);/),k=(v==null?void 0:v[1])??a,w=atob(s[1]??""),r=w.length,c=new Uint8Array(r);for(let h=0;h<r;h+=1)c[h]=w.charCodeAt(h);return new Blob([c],{type:k})}async function Na(u,a,s){return typeof u.toBlob=="function"?await new Promise((v,k)=>{let w=!1;const r=window.setTimeout(()=>{if(!w){w=!0;try{const c=ps(u.toDataURL(a,s),a);v(c)}catch(c){k(c instanceof Error?c:new Error("スナップショットの生成に失敗しました"))}}},xa);u.toBlob(c=>{if(!w)if(w=!0,window.clearTimeout(r),c)v(c);else try{const h=ps(u.toDataURL(a,s),a);v(h)}catch(h){k(h instanceof Error?h:new Error("スナップショットの生成に失敗しました"))}},a,s)}):ps(u.toDataURL(a,s),a)}function vo({open:u,targetLabel:a,onClose:s,onResult:v,onRecognized:k}){const w=o.useRef(null),r=o.useRef(null),c=o.useRef(),h=o.useRef(),[f,N]=o.useState("idle"),[A,C]=o.useState("カメラを初期化しています…"),[Q,R]=o.useState(!1),[z,M]=o.useState(null),[J,E]=o.useState(null);o.useEffect(()=>{c.current=document.createElement("canvas"),h.current=document.createElement("canvas")},[]);const T=o.useCallback(()=>{M(null),E(b=>(b&&URL.revokeObjectURL(b),null))},[]),D=()=>{r.current&&(r.current.getTracks().forEach(b=>b.stop()),r.current=null),w.current&&(w.current.pause(),w.current.srcObject=null)},$=o.useCallback(async()=>{var b;if(T(),!((b=navigator.mediaDevices)!=null&&b.getUserMedia)){N("error"),C("この端末ではカメラを利用できません。手入力してください。"),R(!1);return}N("camera"),C("カメラを起動しています…");try{const _=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}}});r.current=_,w.current&&(w.current.srcObject=_,await w.current.play().catch(()=>{})),N("camera"),C("枠が黒い帯に変わりました。番号を合わせて撮影してください。"),R(!1)}catch(_){const q=_ instanceof Error?_.message:String(_);N("error"),C(`カメラにアクセスできません: ${q}`),R(!1)}},[T]);o.useEffect(()=>{if(!u){D(),T(),N("idle"),C("カメラを初期化しています…"),R(!1);return}return $(),()=>{D()}},[u,$]);const L=async(b,_,q)=>{const g=c.current,F=h.current;if(!g||!F||b===0||_===0)throw new Error("画像データを読み込めませんでした。");g.width=b,g.height=_;const V=g.getContext("2d");if(!V)throw new Error("画像の処理に失敗しました。");q(V);const G=F.getContext("2d");if(!G)throw new Error("画像の処理に失敗しました。");const K={x:Math.floor(g.width*es.left),y:Math.floor(g.height*es.top),width:Math.floor(g.width*es.width),height:Math.floor(g.height*es.height)},oe=K.width>mo?mo/K.width:1,ae=Math.max(320,Math.round(K.width*oe)),le=Math.max(120,Math.round(K.height*oe));return F.width=ae,F.height=le,G.filter="contrast(160%) brightness(115%) grayscale(15%)",G.drawImage(g,K.x,K.y,K.width,K.height,0,0,ae,le),Na(F,"image/jpeg",.92)},x=async()=>{if(!u||Q||f!=="camera")return;const b=w.current;if(!b||b.videoWidth===0||b.videoHeight===0){N("error"),C("カメラ映像を取得できませんでした。");return}R(!0),C("撮影中…");try{const _=await L(b.videoWidth,b.videoHeight,g=>{g.drawImage(b,0,0,b.videoWidth,b.videoHeight)});D(),T();const q=URL.createObjectURL(_);M(_),E(q),N("photo"),C("写真を保存しました。読み取りボタンを押してください。"),R(!1)}catch(_){const q=_ instanceof Error?_.message:String(_);N("error"),C(`撮影に失敗しました: ${q}`),R(!1)}},p=async()=>{if(!(!z||Q)){N("processing"),R(!0),C("読み取り中です。1秒ほどお待ちください…");try{const b=await va(z);b.text?(v(b.text),C(`認識した値: ${b.text}`),k==null||k({text:b.text,method:b.method,targetLabel:a}),s()):(N("error"),C("文字を検出できませんでした。撮り直して再試行してください。"),R(!1))}catch(b){const _=b instanceof Error?b.message:String(b);N("error"),C(`読み取りに失敗しました: ${_}`),R(!1)}}},H=()=>{Q||(T(),$())},B=o.useMemo(()=>f==="photo"?"撮影した画像を確認し、問題なければ「読み取る」を押してください。":f==="processing"?"しばらくお待ちください…":f==="error"?"カメラや照明の状態を確認してください。":"黒いガイド帯の中央に番号を重ね、影や反射を避けて撮影すると精度が上がります。",[f]);return u?e.jsx("div",{className:"ocr-overlay",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"ocr-panel",children:[e.jsxs("header",{className:"ocr-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"ocr-eyebrow",children:"テキストスキャン"}),e.jsxs("h3",{children:[a,"の読み取り"]})]}),e.jsx("button",{type:"button",className:"ghost",onClick:s,children:"閉じる"})]}),e.jsx("div",{className:"ocr-video-container",children:J?e.jsx("img",{src:J,alt:"撮影した画像",className:"ocr-preview"}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:w,playsInline:!0,autoPlay:!0,muted:!0,className:"ocr-video"}),e.jsx("div",{className:"ocr-frame","aria-hidden":"true",children:e.jsx("span",{className:"ocr-frame__label",children:"黒い帯に合わせてください"})})]})}),e.jsx("p",{className:"helper-text",children:B}),e.jsx("p",{className:`ocr-message ${f==="error"?"is-error":""}`,children:A}),e.jsxs("footer",{className:"ocr-footer",children:[e.jsx("button",{type:"button",className:"ghost",onClick:s,disabled:Q&&f==="processing",children:"キャンセル"}),z&&e.jsx("button",{type:"button",className:"ghost",onClick:H,disabled:Q,children:"撮り直し"}),!z&&e.jsx("button",{type:"button",onClick:x,className:"secondary",disabled:Q||f!=="camera",children:"撮影"}),z&&e.jsx("button",{type:"button",onClick:p,className:"secondary",disabled:Q,children:f==="processing"?"読み取り中...":"読み取る"})]})]})}):null}function ba(){var le,xe,ne,Ne,ie,ve,re;Ft();const u=Rt(),a=o.useRef(null),{current:s,photos:v,attachPhoto:k,removePhoto:w,setFields:r}=ft(),[c,h]=o.useState(""),[f,N]=o.useState(""),[A,C]=o.useState(""),[Q,R]=o.useState(!1),[z,M]=o.useState(!1),[J,E]=o.useState(!1),[T,D]=o.useState("assetNo"),[$,L]=o.useState(!1),[x,p]=o.useState(null);o.useEffect(()=>{po()},[]),o.useEffect(()=>{var j,U,we,ge,Me;h(((j=s==null?void 0:s.fields)==null?void 0:j.assetNo)??""),N(((U=s==null?void 0:s.fields)==null?void 0:U.equipmentNo)??""),C(((we=s==null?void 0:s.fields)==null?void 0:we.purchaseDate)??""),R(!!((ge=s==null?void 0:s.fields)!=null&&ge.leaseFlag)),M(!!((Me=s==null?void 0:s.fields)!=null&&Me.loanedFlag))},[(le=s==null?void 0:s.fields)==null?void 0:le.assetNo,(xe=s==null?void 0:s.fields)==null?void 0:xe.equipmentNo,(ne=s==null?void 0:s.fields)==null?void 0:ne.purchaseDate,(Ne=s==null?void 0:s.fields)==null?void 0:Ne.leaseFlag,(ie=s==null?void 0:s.fields)==null?void 0:ie.loanedFlag]);const H=((ve=s==null?void 0:s.fields)==null?void 0:ve.sealNo)??"",B=((re=s==null?void 0:s.fields)==null?void 0:re.roomName)??"",b=o.useMemo(()=>v.map(j=>({id:j.id,url:URL.createObjectURL(j.thumb)})),[v]),_=async j=>{if(!j||j.length===0)return;const U=j[0];await k(U),a.current&&(a.current.value="")},q=()=>{const j=!Q;R(j),r({leaseFlag:j})},g=()=>{const j=!z;M(j),r({loanedFlag:j})},F=()=>{u("/survey/label")},V=()=>{u("/survey/product")},G=v.length>0,K=j=>{j&&(T==="assetNo"?(h(j),r({assetNo:j})):(N(j),r({equipmentNo:j})))},oe=o.useCallback(j=>{p(`${j.targetLabel}を読み取り: ${j.text}`)},[]);o.useEffect(()=>{if(!x)return;const j=window.setTimeout(()=>p(null),5e3);return()=>{window.clearTimeout(j)}},[x]);const ae=j=>{D(j),L(!0)};return e.jsxs("div",{className:"page",children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:a,style:{display:"none"},onChange:j=>_(j.target.files)}),e.jsxs("div",{className:"page-section",children:[x&&e.jsx("div",{className:"ocr-result-banner",children:x}),e.jsx("h2",{className:"section-title",children:"写真撮影・資産No登録"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["シールNo",e.jsx("input",{value:H,disabled:!0})]}),e.jsxs("label",{children:["室名",e.jsx("input",{value:B,disabled:!0})]}),e.jsxs("label",{children:["資産番号",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:c,onChange:j=>{const U=j.target.value;h(U),r({assetNo:U})}}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:()=>ae("assetNo"),children:"読み取り"})]})]}),e.jsxs("label",{children:["備品番号",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:f,onChange:j=>{const U=j.target.value;N(U),r({equipmentNo:U})}}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:()=>ae("equipmentNo"),children:"読み取り"})]})]}),e.jsxs("label",{children:["購入年月日",e.jsx("input",{type:"date",value:A,onChange:j=>{const U=j.target.value;C(U),r({purchaseDate:U})}})]}),e.jsxs("div",{className:"row",children:[e.jsxs("button",{type:"button",className:Q?"secondary":"ghost",onClick:q,children:["リース: ",Q?"ON":"OFF"]}),e.jsxs("button",{type:"button",className:z?"secondary":"ghost",onClick:g,children:["貸出品: ",z?"ON":"OFF"]})]})]}),e.jsx("div",{className:"photo-strip",children:b.map(j=>e.jsxs("div",{className:"photo-item",children:[e.jsx("button",{type:"button",className:"photo-remove",onClick:()=>w(j.id),"aria-label":"写真を削除",children:"×"}),e.jsx("img",{src:j.url,alt:"サムネイル"})]},j.id))})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{className:"ghost",onClick:()=>E(!0),children:"複製"}),e.jsx("button",{className:"ghost",onClick:F,children:"戻る"}),e.jsx("button",{className:"secondary",onClick:()=>{var j;return(j=a.current)==null?void 0:j.click()},children:"写真"}),e.jsx("button",{onClick:V,disabled:!G,children:"次へ"})]}),e.jsx(bs,{open:J,onClose:()=>E(!1)}),e.jsx(vo,{open:$,targetLabel:T==="assetNo"?"資産番号":"備品番号",onClose:()=>L(!1),onResult:K,onRecognized:oe})]})}const Da=Object.freeze(Object.defineProperty({__proto__:null,default:ba},Symbol.toStringTag,{value:"Module"}));function Bt(u,a){return a?u.toLowerCase().includes(a.toLowerCase()):!0}function ja(){var kt,Ke,Ct,ot,l,m,P,te,y;Ft();const u=Rt(),{current:a,setFields:s,completeCurrent:v,listHistory:k}=ft(),[w,r]=o.useState([]),[c,h]=o.useState([]),[f,N]=o.useState([]),[A,C]=o.useState([]),[Q,R]=o.useState([]),[z,M]=o.useState(""),[J,E]=o.useState(""),[T,D]=o.useState(""),[$,L]=o.useState(""),[x,p]=o.useState(""),[H,B]=o.useState(""),[b,_]=o.useState(""),[q,g]=o.useState(""),[F,V]=o.useState(""),[G,K]=o.useState(!1),[oe,ae]=o.useState(!1),[le,xe]=o.useState([]),[ne,Ne]=o.useState(!1),[ie,ve]=o.useState(null),[re,j]=o.useState("asc"),U=o.useRef(void 0),we=o.useRef(void 0),ge=o.useRef(void 0),Me=o.useRef(void 0),be=o.useRef(void 0);o.useEffect(()=>{Promise.all([S.product_categories.toArray(),S.product_subcategories.toArray(),S.product_items.toArray(),S.product_makers.toArray(),S.product_models.toArray()]).then(([n,O,pe,fe,Be])=>{r(n),h(O),N(pe),C(fe),R(Be)})},[]),o.useEffect(()=>{var n,O,pe,fe;B(((n=a==null?void 0:a.fields)==null?void 0:n.width)??""),_(((O=a==null?void 0:a.fields)==null?void 0:O.depth)??""),g(((pe=a==null?void 0:a.fields)==null?void 0:pe.height)??""),V(((fe=a==null?void 0:a.fields)==null?void 0:fe.note)??"")},[(kt=a==null?void 0:a.fields)==null?void 0:kt.width,(Ke=a==null?void 0:a.fields)==null?void 0:Ke.depth,(Ct=a==null?void 0:a.fields)==null?void 0:Ct.height,(ot=a==null?void 0:a.fields)==null?void 0:ot.note]);const de=(l=a==null?void 0:a.fields)==null?void 0:l.categoryId,ce=(m=a==null?void 0:a.fields)==null?void 0:m.subcategoryId,d=(P=a==null?void 0:a.fields)==null?void 0:P.itemId,W=(te=a==null?void 0:a.fields)==null?void 0:te.makerId,ee=(y=a==null?void 0:a.fields)==null?void 0:y.modelId,Y=w.find(n=>n.id===de),X=c.find(n=>n.id===ce),ue=f.find(n=>n.id===d),he=A.find(n=>n.id===W),ye=Q.find(n=>n.id===ee);o.useEffect(()=>{(Y==null?void 0:Y.id)!==U.current&&(Y?M(Y.name):U.current&&M(""),U.current=Y==null?void 0:Y.id)},[Y]),o.useEffect(()=>{(X==null?void 0:X.id)!==we.current&&(X?E(X.name):we.current&&E(""),we.current=X==null?void 0:X.id)},[X]),o.useEffect(()=>{(ue==null?void 0:ue.id)!==ge.current&&(ue?D(ue.name):ge.current&&D(""),ge.current=ue==null?void 0:ue.id)},[ue]),o.useEffect(()=>{(he==null?void 0:he.id)!==Me.current&&(he?L(he.name):Me.current&&L(""),Me.current=he==null?void 0:he.id)},[he]),o.useEffect(()=>{(ye==null?void 0:ye.id)!==be.current&&(ye?p(ye.name):be.current&&p(""),be.current=ye==null?void 0:ye.id)},[ye]);const _e=o.useMemo(()=>w.filter(n=>Bt(n.name,z)),[w,z]),De=o.useMemo(()=>c.filter(n=>Bt(n.name,J)),[c,J]),Ge=o.useMemo(()=>f.filter(n=>Bt(n.name,T)),[f,T]),Re=o.useMemo(()=>A.filter(n=>Bt(n.name,$)),[A,$]),gt=o.useMemo(()=>Q.filter(n=>Bt(n.name,x)),[Q,x]),et=n=>{if(de===n.id){M(""),E(""),D(""),L(""),p(""),s({categoryId:void 0,subcategoryId:void 0,itemId:void 0,makerId:void 0,modelId:void 0});return}M(n.name),E(""),D(""),L(""),p(""),s({categoryId:n.id,subcategoryId:void 0,itemId:void 0,makerId:void 0,modelId:void 0})},tt=n=>{if(ce===n.id){E(""),D(""),L(""),p(""),s({categoryId:de??n.categoryId,subcategoryId:void 0,itemId:void 0,makerId:void 0,modelId:void 0});return}E(n.name),D(""),L(""),p(""),s({categoryId:n.categoryId,subcategoryId:n.id,itemId:void 0,makerId:void 0,modelId:void 0})},pt=n=>{if(d===n.id){D(""),L(""),p(""),s({categoryId:de??n.categoryId,subcategoryId:ce??n.subcategoryId,itemId:void 0,makerId:void 0,modelId:void 0});return}D(n.name),L(""),p(""),s({categoryId:n.categoryId,subcategoryId:n.subcategoryId,itemId:n.id,makerId:void 0,modelId:void 0})},vt=n=>{if(W===n.id){L(""),p(""),s({categoryId:de??n.categoryId,subcategoryId:ce??n.subcategoryId,itemId:d??n.itemId,makerId:void 0,modelId:void 0});return}L(n.name),p(""),s({categoryId:n.categoryId,subcategoryId:n.subcategoryId,itemId:n.itemId,makerId:n.id,modelId:void 0})},yt=n=>{if(ee===n.id){p(""),s({categoryId:de??n.categoryId,subcategoryId:ce??n.subcategoryId,itemId:d??n.itemId,makerId:W??n.makerId,modelId:void 0});return}p(n.name),s({categoryId:n.categoryId,subcategoryId:n.subcategoryId,itemId:n.itemId,makerId:n.makerId,modelId:n.id})},st=o.useCallback(async n=>{Ne(!0),ve(null);try{const O=await k(n);xe(O)}catch(O){const pe=O instanceof Error?O.message:String(O);ve(pe),xe([])}finally{Ne(!1)}},[k]);o.useEffect(()=>{G?st(re):ve(null)},[G,re,st]);const Nt=n=>{const O=n.categoryId,pe=n.subcategoryId,fe=n.itemId,Be=n.makerId,at=n.modelId,Ue=n.width!=null?String(n.width):"",Fe=n.depth!=null?String(n.depth):"",He=n.height!=null?String(n.height):"",$e=n.note!=null?String(n.note):"";B(Ue),_(Fe),g(He),V($e);const qe=w.find(Ee=>Ee.id===O),Ie=c.find(Ee=>Ee.id===pe),nt=f.find(Ee=>Ee.id===fe),it=A.find(Ee=>Ee.id===Be),Ze=Q.find(Ee=>Ee.id===at);M((qe==null?void 0:qe.name)??""),E((Ie==null?void 0:Ie.name)??""),D((nt==null?void 0:nt.name)??""),L((it==null?void 0:it.name)??""),p((Ze==null?void 0:Ze.name)??""),s({categoryId:O,subcategoryId:pe,itemId:fe,makerId:Be,modelId:at,width:Ue,depth:Fe,height:He,note:$e})},bt=n=>{Nt(n.fields??{}),K(!1)},jt=()=>{j(n=>n==="asc"?"desc":"asc")},wt=async()=>{await v({preserveKeys:["surveyDate","investigator","buildingId","floorId","departmentId","divisionId"]}),u("/survey/label")},St=()=>{s({buildingId:void 0,floorId:void 0,departmentId:void 0,divisionId:void 0}),u("/survey/department")};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-section",children:[e.jsx("h2",{className:"section-title",children:"商品登録"}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["大分類",e.jsx("input",{value:z,onChange:n=>M(n.target.value),placeholder:"大分類を検索"})]}),e.jsx("div",{className:"option-list",children:_e.map(n=>e.jsx("button",{onClick:()=>et(n),className:n.id===de?"active":"",children:n.name},n.id))}),e.jsxs("label",{children:["中分類",e.jsx("input",{value:J,onChange:n=>E(n.target.value),placeholder:"中分類を検索"})]}),e.jsx("div",{className:"option-list",children:De.map(n=>e.jsx("button",{onClick:()=>tt(n),className:n.id===ce?"active":"",children:n.name},n.id))}),e.jsxs("label",{children:["品目",e.jsx("input",{value:T,onChange:n=>D(n.target.value),placeholder:"品目を検索"})]}),e.jsx("div",{className:"option-list",children:Ge.map(n=>e.jsx("button",{onClick:()=>pt(n),className:n.id===d?"active":"",children:n.name},n.id))}),e.jsxs("label",{children:["メーカー名",e.jsx("input",{value:$,onChange:n=>L(n.target.value),placeholder:"メーカー名を検索"})]}),e.jsx("div",{className:"option-list",children:Re.map(n=>e.jsx("button",{onClick:()=>vt(n),className:n.id===W?"active":"",children:n.name},n.id))}),e.jsxs("label",{children:["型式",e.jsx("input",{value:x,onChange:n=>p(n.target.value),placeholder:"型式を検索"})]}),e.jsx("div",{className:"option-list",children:gt.map(n=>e.jsx("button",{onClick:()=>yt(n),className:n.id===ee?"active":"",children:n.name},n.id))})]}),e.jsxs("div",{className:"grid",style:{marginTop:16},children:[e.jsxs("label",{children:["W",e.jsx("input",{value:H,onChange:n=>{const O=n.target.value;B(O),s({width:O})},placeholder:"mm"})]}),e.jsxs("label",{children:["D",e.jsx("input",{value:b,onChange:n=>{const O=n.target.value;_(O),s({depth:O})},placeholder:"mm"})]}),e.jsxs("label",{children:["H",e.jsx("input",{value:q,onChange:n=>{const O=n.target.value;g(O),s({height:O})},placeholder:"mm"})]}),e.jsxs("label",{children:["備考",e.jsx("textarea",{value:F,onChange:n=>{const O=n.target.value;V(O),s({note:O})},rows:3})]})]}),e.jsx("div",{className:"row",style:{justifyContent:"flex-start",marginTop:8},children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>K(!0),children:"履歴表示"})})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>ae(!0),children:"複製"}),e.jsx("button",{className:"ghost",onClick:()=>u("/survey/asset"),children:"戻る"}),e.jsx("button",{className:"secondary",onClick:St,children:"部門"}),e.jsx("button",{onClick:wt,children:"次へ"})]}),G&&e.jsx("div",{className:"history-overlay",children:e.jsxs("div",{className:"history-panel",children:[e.jsxs("div",{className:"history-header",children:[e.jsx("h3",{children:"作業履歴"}),e.jsxs("div",{className:"row",children:[e.jsx("button",{className:"ghost",onClick:jt,children:re==="asc"?"降順にする":"昇順にする"}),e.jsx("button",{className:"ghost",onClick:()=>K(!1),children:"閉じる"})]})]}),ne&&e.jsx("p",{className:"helper-text",children:"読み込み中..."}),ie&&e.jsxs("p",{className:"badge warn",children:["エラー: ",ie]}),!ne&&!ie&&le.length===0&&e.jsx("p",{className:"helper-text",children:"表示できる履歴がありません。"}),!ne&&!ie&&le.length>0&&e.jsx("div",{className:"history-list",children:le.map(n=>{var Ie,nt,it,Ze,Ee;const O=n.fields??{},pe=O.completedAt??n.updatedAt,fe=((Ie=w.find(Le=>Le.id===O.categoryId))==null?void 0:Ie.name)??"-",Be=((nt=c.find(Le=>Le.id===O.subcategoryId))==null?void 0:nt.name)??"-",at=((it=f.find(Le=>Le.id===O.itemId))==null?void 0:it.name)??"-",Ue=((Ze=A.find(Le=>Le.id===O.makerId))==null?void 0:Ze.name)??"-",Fe=((Ee=Q.find(Le=>Le.id===O.modelId))==null?void 0:Ee.name)??"-",He=O.width??"-",$e=O.depth??"-",qe=O.height??"-";return e.jsxs("button",{type:"button",className:"history-row",onClick:()=>bt(n),children:[e.jsxs("div",{className:"history-meta",children:[e.jsx("span",{children:new Date(pe).toLocaleString()}),O.assetNo&&e.jsxs("span",{className:"pill",children:["資産 ",O.assetNo]}),O.equipmentNo&&e.jsxs("span",{className:"pill",children:["備品 ",O.equipmentNo]}),O.sealNo&&e.jsxs("span",{className:"pill",children:["QR ",O.sealNo]})]}),e.jsxs("div",{className:"history-tags",children:[e.jsx("span",{className:"pill",children:fe}),e.jsx("span",{className:"pill",children:Be}),e.jsx("span",{className:"pill",children:at}),e.jsx("span",{className:"pill",children:Ue}),e.jsx("span",{className:"pill",children:Fe})]}),e.jsxs("div",{className:"history-meta",children:[e.jsxs("span",{children:["W: ",He]}),e.jsxs("span",{children:["D: ",$e]}),e.jsxs("span",{children:["H: ",qe]})]})]},n.id)})})]})}),e.jsx(bs,{open:oe,onClose:()=>ae(!1)})]})}const Ra=Object.freeze(Object.defineProperty({__proto__:null,default:ja},Symbol.toStringTag,{value:"Module"}));function Je(u,a){return a?u.toLowerCase().includes(a.toLowerCase()):!0}function Fa(){var Ds,Rs,Fs,As,Ls,Qs,Ts,Ps,Bs,Us,Hs,$s,qs,Ws,zs,Gs,Ks,Zs,Vs,Xs,Ys,Js,eo,to,so,oo,ao,no,io,ro,lo;Ft();const u=Rt(),a=ft(),{current:s,photos:v,attachPhoto:k,removePhoto:w,setFields:r,completeCurrent:c,listHistory:h,load:f,completedCount:N,duplicateDraft:A,setQR:C,togglePhotoForList:Q}=a,[R,z]=o.useState([]),[M,J]=o.useState([]),[E,T]=o.useState([]),[D,$]=o.useState([]),[L,x]=o.useState(""),[p,H]=o.useState(""),[B,b]=o.useState(""),[_,q]=o.useState(""),[g,F]=o.useState(void 0),[V,G]=o.useState(void 0),[K,oe]=o.useState(void 0),[ae,le]=o.useState(void 0),xe=o.useMemo(()=>{const t=new Date;return`${t.getFullYear()}年${String(t.getMonth()+1).padStart(2,"0")}月${String(t.getDate()).padStart(2,"0")}日`},[]),ne=typeof window<"u"?sessionStorage.getItem("mockUserEmail")??"":"";o.useEffect(()=>{Promise.all([S.location_buildings.toArray(),S.location_floors.toArray(),S.location_departments.toArray(),S.location_divisions.toArray()]).then(([t,i,I,Z])=>{z(t),J(i),T(I),$(Z)})},[]),o.useEffect(()=>{var i,I;if(!s)return;const t={};(i=s.fields)!=null&&i.surveyDate||(t.surveyDate=xe),ne&&((I=s.fields)==null?void 0:I.investigator)!==ne&&(t.investigator=ne),Object.keys(t).length>0&&r(t)},[s,ne,r,xe]);const Ne=(Ds=s==null?void 0:s.fields)==null?void 0:Ds.buildingId,ie=(Rs=s==null?void 0:s.fields)==null?void 0:Rs.floorId,ve=(Fs=s==null?void 0:s.fields)==null?void 0:Fs.departmentId,re=(As=s==null?void 0:s.fields)==null?void 0:As.divisionId;o.useEffect(()=>{F(Ne)},[Ne]),o.useEffect(()=>{G(ie)},[ie]),o.useEffect(()=>{oe(ve)},[ve]),o.useEffect(()=>{le(re)},[re]);const j=o.useMemo(()=>R.find(t=>t.id===g),[R,g]),U=o.useMemo(()=>M.find(t=>t.id===V),[M,V]),we=o.useMemo(()=>E.find(t=>t.id===K),[E,K]),ge=o.useMemo(()=>D.find(t=>t.id===ae),[D,ae]);o.useEffect(()=>{x((j==null?void 0:j.name)??"")},[j]),o.useEffect(()=>{H((U==null?void 0:U.name)??"")},[U]),o.useEffect(()=>{b((we==null?void 0:we.name)??"")},[we]),o.useEffect(()=>{q((ge==null?void 0:ge.name)??"")},[ge]),o.useMemo(()=>R.filter(t=>Je(t.name,L)),[R,L]),o.useMemo(()=>M.filter(t=>Je(t.name,p)),[M,p]),o.useMemo(()=>E.filter(t=>Je(t.name,B)),[E,B]),o.useMemo(()=>D.filter(t=>Je(t.name,_)),[D,_]);const Me=!!(g&&V&&K&&ae),be=o.useRef(null),[de,ce]=o.useState(""),[d,W]=o.useState(""),[ee,Y]=o.useState([]),[X,ue]=o.useState(!1),[he,ye]=o.useState(!1),[_e,De]=o.useState(""),[Ge,Re]=o.useState(""),[gt,et]=o.useState("single");o.useEffect(()=>{var t,i;ce(((t=s==null?void 0:s.fields)==null?void 0:t.sealNo)??""),W(((i=s==null?void 0:s.fields)==null?void 0:i.roomName)??"")},[(Ls=s==null?void 0:s.fields)==null?void 0:Ls.sealNo,(Qs=s==null?void 0:s.fields)==null?void 0:Qs.roomName]),o.useEffect(()=>()=>{var t;(t=be.current)==null||t.stop()},[]),o.useEffect(()=>{let t=!0;return S.location_rooms.toArray().then(i=>{t&&Y(i)}).catch(()=>{t&&Y([])}),()=>{t=!1}},[]);const tt=(Ts=s==null?void 0:s.fields)==null?void 0:Ts.buildingId,pt=(Ps=s==null?void 0:s.fields)==null?void 0:Ps.floorId,vt=(Bs=s==null?void 0:s.fields)==null?void 0:Bs.departmentId,yt=(Us=s==null?void 0:s.fields)==null?void 0:Us.divisionId,st=o.useMemo(()=>{const t=d.trim().toLowerCase();let i=ee;return tt&&pt&&vt&&yt&&(i=i.filter(I=>!(I.buildingId!==tt||I.floorId!==pt||I.departmentId!==vt||I.divisionId!==yt))),t?i.filter(I=>I.name.toLowerCase().includes(t)):i},[ee,tt,pt,vt,yt,d]),Nt=t=>{const i=t.trim(),I=i.match(/https?:\/\/[^/]+\/x\/([A-Za-z0-9-]+)$/i),Z=i.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i),se=I&&I[1]||Z&&Z[0]||i;gt==="bulkStart"?(De(se),r({bulkStartSealNo:se})):gt==="bulkEnd"?(Re(se),r({bulkEndSealNo:se})):(ce(se),C(se))},bt=t=>{ce(t),r({sealNo:t,qrCode:t})},jt=t=>{W(t),r({roomName:t}),ue(!1)},wt=t=>{ye(t),t?de.trim()&&(De(de),Re(de),r({bulkStartSealNo:de,bulkEndSealNo:de})):_e.trim()&&(ce(_e),r({sealNo:_e,qrCode:_e}))},St=(t,i)=>{const I=t.match(/(\d+)(?!.*\d)/),Z=i.match(/(\d+)(?!.*\d)/);if(!I||!Z||I.index===void 0||Z.index===void 0)return null;const se=Number.parseInt(I[1],10),ke=Number.parseInt(Z[1],10),Ce=I[1].length,Te=Z[1].length===Ce,Ae=t.slice(0,I.index),Xe=t.slice(I.index+Ce),ze=i.slice(0,Z.index),Pe=i.slice(Z.index+Z[1].length);return!Te||!(Ae===ze&&Xe===Pe)||ke<se?null:ke-se+1},kt=o.useMemo(()=>{const t=d.trim().length>0,i=de.trim().length>0,I=St(_e.trim(),Ge.trim()),Z=he&&I!==null&&I>0;return t&&(!he&&i||Z)},[he,_e,Ge,d,de]),Ke=o.useRef(null),[Ct,ot]=o.useState(""),[l,m]=o.useState(""),[P,te]=o.useState(""),[y,n]=o.useState(!1),[O,pe]=o.useState(!1),[fe,Be]=o.useState("assetNo"),[at,Ue]=o.useState(!1),[Fe,He]=o.useState(null);o.useEffect(()=>{po()},[]),o.useEffect(()=>{var t,i,I,Z,se,ke,Ce;ot(((t=s==null?void 0:s.fields)==null?void 0:t.assetNo)??""),m(((i=s==null?void 0:s.fields)==null?void 0:i.equipmentNo)??""),te(((I=s==null?void 0:s.fields)==null?void 0:I.purchaseDate)??""),n(!!((Z=s==null?void 0:s.fields)!=null&&Z.leaseFlag)),pe(!!((se=s==null?void 0:s.fields)!=null&&se.loanedFlag)),De(((ke=s==null?void 0:s.fields)==null?void 0:ke.bulkStartSealNo)??""),Re(((Ce=s==null?void 0:s.fields)==null?void 0:Ce.bulkEndSealNo)??"")},[(Hs=s==null?void 0:s.fields)==null?void 0:Hs.assetNo,($s=s==null?void 0:s.fields)==null?void 0:$s.equipmentNo,(qs=s==null?void 0:s.fields)==null?void 0:qs.purchaseDate,(Ws=s==null?void 0:s.fields)==null?void 0:Ws.leaseFlag,(zs=s==null?void 0:s.fields)==null?void 0:zs.loanedFlag,(Gs=s==null?void 0:s.fields)==null?void 0:Gs.bulkStartSealNo,(Ks=s==null?void 0:s.fields)==null?void 0:Ks.bulkEndSealNo]);const $e=o.useMemo(()=>v.map(t=>({id:t.id,url:URL.createObjectURL(t.thumb),selectedForList:!!t.selectedForList})),[v]),qe=async t=>{if(!t||t.length===0)return;const i=t[0];await k(i),Ke.current&&(Ke.current.value="")},Ie=()=>{const t=!y;n(t),r({leaseFlag:t})},nt=()=>{const t=!O;pe(t),r({loanedFlag:t})},it=t=>{t&&(fe==="assetNo"?(ot(t),r({assetNo:t})):(m(t),r({equipmentNo:t})))},Ze=t=>{Be(t),Ue(!0)},Ee=o.useCallback(t=>{He(`${t.targetLabel}を読み取り: ${t.text}`)},[]);o.useEffect(()=>{if(!Fe)return;const t=window.setTimeout(()=>He(null),5e3);return()=>{window.clearTimeout(t)}},[Fe]);const Le=v.length>0,[It,yo]=o.useState([]),[rt,Io]=o.useState([]),[dt,xo]=o.useState([]),[lt,No]=o.useState([]),[Et,bo]=o.useState([]),[At,Lt]=o.useState(""),[Qt,ct]=o.useState(""),[Tt,Qe]=o.useState(""),[Pt,Oe]=o.useState(""),[ss,je]=o.useState(""),[jo,Ht]=o.useState(!1),[wo,$t]=o.useState(!1),[So,qt]=o.useState(!1),[ko,Wt]=o.useState(!1),[Co,zt]=o.useState(!1),[Eo,os]=o.useState(""),[Oo,as]=o.useState(""),[Mo,ns]=o.useState(""),[_o,is]=o.useState(""),[rs,js]=o.useState(!1),[ds,ws]=o.useState([]),[ls,Ss]=o.useState(!1),[Gt,cs]=o.useState(null),[us,Do]=o.useState("asc");o.useEffect(()=>{Promise.all([S.product_categories.toArray(),S.product_subcategories.toArray(),S.product_items.toArray(),S.product_makers.toArray(),S.product_models.toArray()]).then(([t,i,I,Z,se])=>{yo(t),Io(i),xo(I),No(Z),bo(se)})},[]),o.useEffect(()=>{var t,i,I,Z;os(((t=s==null?void 0:s.fields)==null?void 0:t.width)??""),as(((i=s==null?void 0:s.fields)==null?void 0:i.depth)??""),ns(((I=s==null?void 0:s.fields)==null?void 0:I.height)??""),is(((Z=s==null?void 0:s.fields)==null?void 0:Z.note)??"")},[(Zs=s==null?void 0:s.fields)==null?void 0:Zs.width,(Vs=s==null?void 0:s.fields)==null?void 0:Vs.depth,(Xs=s==null?void 0:s.fields)==null?void 0:Xs.height,(Ys=s==null?void 0:s.fields)==null?void 0:Ys.note]);const We=(Js=s==null?void 0:s.fields)==null?void 0:Js.categoryId,Ve=(eo=s==null?void 0:s.fields)==null?void 0:eo.subcategoryId,ut=(to=s==null?void 0:s.fields)==null?void 0:to.itemId,xt=(so=s==null?void 0:s.fields)==null?void 0:so.makerId,ms=(oo=s==null?void 0:s.fields)==null?void 0:oo.modelId,Kt=It.find(t=>t.id===We),Zt=rt.find(t=>t.id===Ve),Vt=dt.find(t=>t.id===ut),Xt=lt.find(t=>t.id===xt),Yt=Et.find(t=>t.id===ms);o.useEffect(()=>{const t=(s==null?void 0:s.fields)??{},i=t.categoryName??(Kt==null?void 0:Kt.name)??"",I=t.subcategoryName??(Zt==null?void 0:Zt.name)??"",Z=t.itemName??(Vt==null?void 0:Vt.name)??"",se=t.makerName??(Xt==null?void 0:Xt.name)??"",ke=t.modelName??(Yt==null?void 0:Yt.name)??"";Lt(i),ct(I),Qe(Z),Oe(se),je(ke)},[(ao=s==null?void 0:s.fields)==null?void 0:ao.categoryName,(no=s==null?void 0:s.fields)==null?void 0:no.subcategoryName,(io=s==null?void 0:s.fields)==null?void 0:io.itemName,(ro=s==null?void 0:s.fields)==null?void 0:ro.makerName,(lo=s==null?void 0:s.fields)==null?void 0:lo.modelName,Kt,Zt,Vt,Xt,Yt]);const ks=o.useMemo(()=>It.filter(t=>Je(t.name,At)),[It,At]),Ot=o.useMemo(()=>{if(We)return We;const t=At.trim().toLowerCase();if(!t)return null;const i=It.find(I=>I.name.toLowerCase()===t);return(i==null?void 0:i.id)??null},[It,We,At]),Cs=o.useMemo(()=>(Ot?rt.filter(i=>i.categoryId===Ot):rt).filter(i=>Je(i.name,Qt)),[Ot,rt,Qt]),Mt=o.useMemo(()=>{if(Ve)return Ve;const t=Qt.trim().toLowerCase();if(!t||!Ot)return null;const i=rt.find(I=>I.categoryId===Ot&&I.name.toLowerCase()===t);return(i==null?void 0:i.id)??null},[Ot,rt,Ve,Qt]),Es=o.useMemo(()=>(Mt?dt.filter(i=>i.subcategoryId===Mt):dt).filter(i=>Je(i.name,Tt)),[Mt,dt,Tt]),_t=o.useMemo(()=>{if(ut)return ut;const t=Tt.trim().toLowerCase();if(!t||!Mt)return null;const i=dt.find(I=>I.subcategoryId===Mt&&I.name.toLowerCase()===t);return(i==null?void 0:i.id)??null},[Mt,dt,ut,Tt]),Os=o.useMemo(()=>(_t?lt.filter(i=>i.itemId===_t):lt).filter(i=>Je(i.name,Pt)),[_t,lt,Pt]),hs=o.useMemo(()=>{if(xt)return xt;const t=Pt.trim().toLowerCase();if(!t||!_t)return null;const i=lt.find(I=>I.itemId===_t&&I.name.toLowerCase()===t);return(i==null?void 0:i.id)??null},[_t,lt,xt,Pt]),Ms=o.useMemo(()=>(hs?Et.filter(i=>i.makerId===hs):Et).filter(i=>Je(i.name,ss)),[hs,Et,ss]),Ro=t=>{Lt(t),ct(""),Qe(""),Oe(""),je(""),r({categoryName:t,categoryId:void 0,subcategoryId:void 0,subcategoryName:void 0,itemId:void 0,itemName:void 0,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0})},Fo=t=>{ct(t),Qe(""),Oe(""),je(""),r({subcategoryName:t,subcategoryId:void 0,itemId:void 0,itemName:void 0,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0})},Ao=t=>{Qe(t),Oe(""),je(""),r({itemName:t,itemId:void 0,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0})},Lo=t=>{Oe(t),je(""),r({makerName:t,makerId:void 0,modelId:void 0,modelName:void 0})},Qo=t=>{je(t),r({modelName:t,modelId:void 0})},To=t=>{if(We===t.id){Lt(""),ct(""),Qe(""),Oe(""),je(""),r({categoryId:void 0,categoryName:void 0,subcategoryId:void 0,subcategoryName:void 0,itemId:void 0,itemName:void 0,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0});return}Lt(t.name),ct(""),Qe(""),Oe(""),je(""),Ht(!1),r({categoryId:t.id,categoryName:t.name,subcategoryId:void 0,subcategoryName:void 0,itemId:void 0,itemName:void 0,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0})},Po=t=>{if(Ve===t.id){ct(""),Qe(""),Oe(""),je(""),r({categoryId:We??t.categoryId,subcategoryId:void 0,subcategoryName:void 0,itemId:void 0,itemName:void 0,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0});return}ct(t.name),Qe(""),Oe(""),je(""),$t(!1),r({categoryId:t.categoryId,subcategoryId:t.id,subcategoryName:t.name,itemId:void 0,itemName:void 0,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0})},Bo=t=>{if(ut===t.id){Qe(""),Oe(""),je(""),r({categoryId:We??t.categoryId,subcategoryId:Ve??t.subcategoryId,itemId:void 0,itemName:void 0,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0});return}Qe(t.name),Oe(""),je(""),qt(!1),r({categoryId:t.categoryId,subcategoryId:t.subcategoryId,itemId:t.id,itemName:t.name,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0})},Uo=t=>{if(xt===t.id){Oe(""),je(""),r({categoryId:We??t.categoryId,subcategoryId:Ve??t.subcategoryId,itemId:ut??t.itemId,makerId:void 0,makerName:void 0,modelId:void 0,modelName:void 0});return}Oe(t.name),je(""),Wt(!1),r({categoryId:t.categoryId,subcategoryId:t.subcategoryId,itemId:t.itemId,makerId:t.id,makerName:t.name,modelId:void 0,modelName:void 0})},Ho=t=>{if(ms===t.id){je(""),r({categoryId:We??t.categoryId,subcategoryId:Ve??t.subcategoryId,itemId:ut??t.itemId,makerId:xt??t.makerId,modelId:void 0,modelName:void 0});return}je(t.name),zt(!1),r({categoryId:t.categoryId,subcategoryId:t.subcategoryId,itemId:t.itemId,makerId:t.makerId,modelId:t.id,modelName:t.name})},_s=o.useCallback(async t=>{Ss(!0),cs(null);try{const i=await h(t);ws(i)}catch(i){const I=i instanceof Error?i.message:String(i);cs(I),ws([])}finally{Ss(!1)}},[h]);o.useEffect(()=>{rs?_s(us):cs(null)},[rs,us,_s]);const $o=t=>{const i=t.categoryId,I=t.subcategoryId,Z=t.itemId,se=t.makerId,ke=t.modelId,Ce=t.width!=null?String(t.width):"",Te=t.depth!=null?String(t.depth):"",Ae=t.height!=null?String(t.height):"",Xe=t.note!=null?String(t.note):"";os(Ce),as(Te),ns(Ae),is(Xe);const ze=It.find(me=>me.id===i),Pe=rt.find(me=>me.id===I),Ye=dt.find(me=>me.id===Z),mt=lt.find(me=>me.id===se),ht=Et.find(me=>me.id===ke);Lt((ze==null?void 0:ze.name)??""),ct((Pe==null?void 0:Pe.name)??""),Qe((Ye==null?void 0:Ye.name)??""),Oe((mt==null?void 0:mt.name)??""),je((ht==null?void 0:ht.name)??""),r({categoryId:i,subcategoryId:I,itemId:Z,makerId:se,modelId:ke,width:Ce,depth:Te,height:Ae,note:Xe})},qo=t=>{$o(t.fields??{}),js(!1)},Wo=()=>{Do(t=>t==="asc"?"desc":"asc")},zo=async()=>{var ke;if(!he){const Ce=((ke=s==null?void 0:s.fields)==null?void 0:ke.sealNo)??de;let Te=null;if(Ce){const Ae=Ce.match(/(\d+)(?!.*\d)/);if(Ae&&Ae.index!==void 0){const Xe=Ae.index,ze=Number.parseInt(Ae[1],10),Pe=Ae[1].length,Ye=Ce.slice(0,Xe),mt=Ce.slice(Xe+Pe),ht=ze+1,me=String(ht).padStart(Pe,"0");Te=`${Ye}${me}${mt}`}}await c({preserveKeys:["surveyDate","investigator","buildingId","floorId","departmentId","divisionId"]}),Te&&(ce(Te),await C(Te));return}const t=_e.trim(),i=Ge.trim(),I=St(t,i);if(!I||I<=0){alert("一括登録モードでは、開始・終了シールNoを連番で入力してください。");return}if(!s)return;const Z=s.id;ce(t),await C(t),await c({preserveKeys:["surveyDate","investigator","buildingId","floorId","departmentId","divisionId"]});const se=I-1;se>0&&await A(Z,se)},Go=async()=>{try{const i=(await h("desc"))[0];if(!i)return;await f(i.id)}catch(t){console.error(t)}};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-section",children:[e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["登録モード",e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("input",{type:"checkbox",checked:he,onChange:t=>wt(t.target.checked),style:{width:16,height:16}}),e.jsx("span",{children:"一括登録モード"})]})]}),he?e.jsxs("label",{children:["開始シールNo",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:_e,onChange:t=>{const i=t.target.value;De(i),r({bulkStartSealNo:i})},placeholder:"開始シールNoを入力"}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:async()=>{var t;try{et("bulkStart"),await ts(),await((t=be.current)==null?void 0:t.start())}catch(i){const I=i instanceof Error?i.message:String(i);alert(`カメラを利用できませんでした: ${I}`)}},children:"QR撮影"})]})]}):e.jsxs("label",{children:["シールNo",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:de,onChange:t=>bt(t.target.value),placeholder:"シールNoを入力"}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:async()=>{var t;try{et("single"),await ts(),await((t=be.current)==null?void 0:t.start())}catch(i){const I=i instanceof Error?i.message:String(i);alert(`カメラを利用できませんでした: ${I}`)}},children:"QR撮影"})]})]}),e.jsxs("label",{children:["室名",e.jsx("input",{value:d,onChange:t=>{W(t.target.value),r({roomName:t.target.value}),ue(!0)},onFocus:()=>ue(!0),onBlur:()=>{window.setTimeout(()=>{ue(!1)},100)},placeholder:"室名を入力"}),X&&st.length>0&&e.jsx("div",{className:"option-list",style:{marginTop:6},children:st.map(t=>e.jsx("button",{type:"button",onClick:()=>jt(t.name),children:t.name},t.id))})]})]}),e.jsx("div",{style:{marginTop:16},children:e.jsx(Ns,{ref:be,onResult:Nt})}),e.jsx("div",{className:"section-title-underline-blue",style:{margin:"20px 0"}}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:Ke,style:{display:"none"},onChange:t=>qe(t.target.files)}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["資産番号",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:Ct,onChange:t=>{const i=t.target.value;ot(i),r({assetNo:i})}}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:()=>Ze("assetNo"),children:"読み取り"})]})]}),e.jsxs("label",{children:["備品番号",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:l,onChange:t=>{const i=t.target.value;m(i),r({equipmentNo:i})}}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:()=>Ze("equipmentNo"),children:"読み取り"})]})]}),e.jsxs("label",{children:["購入年月日",e.jsx("input",{type:"date",className:"date-input",value:P,onChange:t=>{const i=t.target.value;te(i),r({purchaseDate:i})}})]}),e.jsxs("div",{className:"row",children:[e.jsxs("button",{type:"button",className:y?"secondary":"ghost",onClick:Ie,children:["リース: ",y?"ON":"OFF"]}),e.jsxs("button",{type:"button",className:O?"secondary":"ghost",onClick:nt,children:["貸出品: ",O?"ON":"OFF"]})]})]}),e.jsx("div",{className:"photo-strip",children:$e.length===0?e.jsx("div",{className:"photo-strip-empty",children:"撮影した写真がここに表示されます"}):$e.map(t=>e.jsxs("div",{className:`photo-item${t.selectedForList?" is-selected":""}`,onClick:()=>{Q(t.id)},children:[e.jsx("span",{className:"visually-hidden",children:"一覧表示用の写真として選択"}),e.jsx("button",{type:"button",className:"photo-remove",onClick:i=>{i.stopPropagation(),w(t.id)},"aria-label":"写真を削除",children:"×"}),e.jsx("img",{src:t.url,alt:"サムネイル"})]},t.id))}),Fe&&e.jsx("div",{className:"ocr-result-banner",children:Fe}),e.jsx("div",{className:"section-title-underline-blue",style:{margin:"20px 0"}}),e.jsxs("div",{className:"grid",children:[e.jsxs("label",{children:["大分類",e.jsx("input",{value:At,onChange:t=>{Ro(t.target.value),Ht(!0)},onFocus:()=>Ht(!0),onBlur:()=>{window.setTimeout(()=>{Ht(!1)},100)},placeholder:"大分類を検索"})]}),jo&&ks.length>0&&e.jsx("div",{className:"option-list",children:ks.map(t=>e.jsx("button",{onClick:()=>To(t),className:t.id===We?"active":"",children:t.name},t.id))}),e.jsxs("label",{children:["中分類",e.jsx("input",{value:Qt,onChange:t=>{Fo(t.target.value),$t(!0)},onFocus:()=>$t(!0),onBlur:()=>{window.setTimeout(()=>{$t(!1)},100)},placeholder:"中分類を検索"})]}),wo&&Cs.length>0&&e.jsx("div",{className:"option-list",children:Cs.map(t=>e.jsx("button",{onClick:()=>Po(t),className:t.id===Ve?"active":"",children:t.name},t.id))}),e.jsxs("label",{children:["品目",e.jsx("input",{value:Tt,onChange:t=>{Ao(t.target.value),qt(!0)},onFocus:()=>qt(!0),onBlur:()=>{window.setTimeout(()=>{qt(!1)},100)},placeholder:"品目を検索"})]}),So&&Es.length>0&&e.jsx("div",{className:"option-list",children:Es.map(t=>e.jsx("button",{onClick:()=>Bo(t),className:t.id===ut?"active":"",children:t.name},t.id))}),e.jsxs("label",{children:["メーカー名",e.jsx("input",{value:Pt,onChange:t=>{Lo(t.target.value),Wt(!0)},onFocus:()=>Wt(!0),onBlur:()=>{window.setTimeout(()=>{Wt(!1)},100)},placeholder:"メーカー名を検索"})]}),ko&&Os.length>0&&e.jsx("div",{className:"option-list",children:Os.map(t=>e.jsx("button",{onClick:()=>Uo(t),className:t.id===xt?"active":"",children:t.name},t.id))}),e.jsxs("label",{children:["型式",e.jsx("input",{value:ss,onChange:t=>{Qo(t.target.value),zt(!0)},onFocus:()=>zt(!0),onBlur:()=>{window.setTimeout(()=>{zt(!1)},100)},placeholder:"型式を検索"})]}),Co&&Ms.length>0&&e.jsx("div",{className:"option-list",children:Ms.map(t=>e.jsx("button",{onClick:()=>Ho(t),className:t.id===ms?"active":"",children:t.name},t.id))})]}),e.jsxs("div",{className:"grid",style:{marginTop:16},children:[e.jsxs("div",{className:"asset-size-row",children:[e.jsxs("label",{children:["W",e.jsx("input",{value:Eo,onChange:t=>{const i=t.target.value;os(i),r({width:i})},placeholder:"mm"})]}),e.jsxs("label",{children:["D",e.jsx("input",{value:Oo,onChange:t=>{const i=t.target.value;as(i),r({depth:i})},placeholder:"mm"})]}),e.jsxs("label",{children:["H",e.jsx("input",{value:Mo,onChange:t=>{const i=t.target.value;ns(i),r({height:i})},placeholder:"mm"})]})]}),e.jsxs("label",{children:["備考",e.jsx("textarea",{value:_o,onChange:t=>{const i=t.target.value;is(i),r({note:i})},rows:3})]})]}),he&&e.jsx("div",{className:"grid",style:{marginTop:12},children:e.jsxs("label",{children:["終了シールNo",e.jsxs("div",{className:"input-with-action",children:[e.jsx("input",{value:Ge,onChange:t=>{const i=t.target.value;Re(i),r({bulkEndSealNo:i})},placeholder:"終了シールNoを入力"}),e.jsx("button",{type:"button",className:"ghost input-action",onClick:async()=>{var t;try{et("bulkEnd"),await ts(),await((t=be.current)==null?void 0:t.start())}catch(i){const I=i instanceof Error?i.message:String(i);alert(`カメラを利用できませんでした: ${I}`)}},children:"QR撮影"})]})]})})]}),e.jsxs("footer",{className:"page-footer",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>u("/survey/home"),children:"ホーム"}),e.jsxs("button",{type:"button",className:"ghost",onClick:()=>u("/survey/department"),children:["部門",e.jsx("br",{}),"入力へ"]}),e.jsxs("button",{type:"button",className:"ghost",onClick:()=>u("/survey/history"),children:["履歴",e.jsx("br",{}),"表示"]}),e.jsxs("button",{type:"button",className:"secondary",onClick:()=>{var t;return(t=Ke.current)==null?void 0:t.click()},children:["写真",e.jsx("br",{}),"撮影"]}),e.jsxs("button",{type:"button",className:"ghost",onClick:Go,disabled:N===0,children:["前の商品に",e.jsx("br",{}),"戻る"]}),e.jsxs("button",{type:"button",onClick:zo,disabled:!(Me&&kt&&Le),children:["商品",e.jsx("br",{}),"登録"]})]}),e.jsx(vo,{open:at,targetLabel:fe==="assetNo"?"資産番号":"備品番号",onClose:()=>Ue(!1),onResult:it,onRecognized:Ee}),rs&&e.jsx("div",{className:"history-overlay",children:e.jsxs("div",{className:"history-panel",children:[e.jsxs("div",{className:"history-header",children:[e.jsx("h3",{children:"作業履歴"}),e.jsxs("div",{className:"row",children:[e.jsx("button",{className:"ghost",onClick:Wo,children:us==="asc"?"降順にする":"昇順にする"}),e.jsx("button",{className:"ghost",onClick:()=>js(!1),children:"閉じる"})]})]}),ls&&e.jsx("p",{className:"helper-text",children:"読み込み中..."}),Gt&&e.jsxs("p",{className:"badge warn",children:["エラー: ",Gt]}),!ls&&!Gt&&ds.length===0&&e.jsx("p",{className:"helper-text",children:"表示できる履歴がありません。"}),!ls&&!Gt&&ds.length>0&&e.jsx("div",{className:"history-list",children:e.jsxs("table",{className:"history-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"大分類"}),e.jsx("th",{children:"中分類"}),e.jsx("th",{children:"品目"}),e.jsx("th",{children:"メーカー名"}),e.jsx("th",{children:"型式"}),e.jsx("th",{children:"W"}),e.jsx("th",{children:"D"}),e.jsx("th",{children:"H"})]})}),e.jsx("tbody",{children:ds.map(t=>{var ze,Pe,Ye,mt,ht;const i=t.fields??{},I=i.categoryName??((ze=It.find(me=>me.id===i.categoryId))==null?void 0:ze.name)??"-",Z=i.subcategoryName??((Pe=rt.find(me=>me.id===i.subcategoryId))==null?void 0:Pe.name)??"-",se=i.itemName??((Ye=dt.find(me=>me.id===i.itemId))==null?void 0:Ye.name)??"-",ke=i.makerName??((mt=lt.find(me=>me.id===i.makerId))==null?void 0:mt.name)??"-",Ce=i.modelName??((ht=Et.find(me=>me.id===i.modelId))==null?void 0:ht.name)??"-",Te=i.width??"-",Ae=i.depth??"-",Xe=i.height??"-";return e.jsxs("tr",{className:"history-row",onClick:()=>qo(t),children:[e.jsx("td",{children:I}),e.jsx("td",{children:Z}),e.jsx("td",{children:se}),e.jsx("td",{children:ke}),e.jsx("td",{children:Ce}),e.jsx("td",{children:Te}),e.jsx("td",{children:Ae}),e.jsx("td",{children:Xe})]},t.id)})})]})})]})})]})}function Ut(u,a){return u.toLowerCase().includes(a.trim().toLowerCase())}function Aa(){Ft();const u=Rt(),{listHistory:a,setFields:s,setQR:v}=ft(),[k,w]=o.useState([]),[r,c]=o.useState(null),[h,f]=o.useState(!1),[N,A]=o.useState(""),[C,Q]=o.useState(""),[R,z]=o.useState(""),[M,J]=o.useState([]),[E,T]=o.useState([]),[D,$]=o.useState([]),[L,x]=o.useState([]),[p,H]=o.useState([]),[B,b]=o.useState(""),[_,q]=o.useState(""),[g,F]=o.useState(""),[V,G]=o.useState(""),[K,oe]=o.useState(""),[ae,le]=o.useState(null),[xe,ne]=o.useState(null),[Ne,ie]=o.useState(null),[ve,re]=o.useState(null),[j,U]=o.useState(null),[we,ge]=o.useState(!1),[Me,be]=o.useState(!1),[de,ce]=o.useState(!1),[d,W]=o.useState(!1),[ee,Y]=o.useState(!1);o.useEffect(()=>{Promise.all([a("desc"),S.product_categories.toArray(),S.product_subcategories.toArray(),S.product_items.toArray(),S.product_makers.toArray(),S.product_models.toArray()]).then(([l,m,P,te,y,n])=>{w(l),J(m),T(P),$(te),x(y),H(n)})},[a]);const X=o.useMemo(()=>k.find(l=>l.id===r),[k,r]),ue=o.useMemo(()=>{if(ae)return ae;const l=B.trim().toLowerCase();if(!l)return null;const m=M.find(P=>P.name.toLowerCase()===l);return(m==null?void 0:m.id)??null},[ae,B,M]),he=o.useMemo(()=>M.filter(l=>Ut(l.name,B)),[M,B]),ye=o.useMemo(()=>{if(xe)return xe;const l=_.trim().toLowerCase();if(!l||!ue)return null;const m=E.find(P=>P.categoryId===ue&&P.name.toLowerCase()===l);return(m==null?void 0:m.id)??null},[xe,_,ue,E]),_e=o.useMemo(()=>(ue?E.filter(m=>m.categoryId===ue):E).filter(m=>Ut(m.name,_)),[ue,E,_]),De=o.useMemo(()=>{if(Ne)return Ne;const l=g.trim().toLowerCase();if(!l||!ye)return null;const m=D.find(P=>P.subcategoryId===ye&&P.name.toLowerCase()===l);return(m==null?void 0:m.id)??null},[Ne,g,ye,D]),Ge=o.useMemo(()=>(ye?D.filter(m=>m.subcategoryId===ye):D).filter(m=>Ut(m.name,g)),[ye,D,g]),Re=o.useMemo(()=>{if(ve)return ve;const l=V.trim().toLowerCase();if(!l||!De)return null;const m=L.find(P=>P.itemId===De&&P.name.toLowerCase()===l);return(m==null?void 0:m.id)??null},[ve,V,De,L]),gt=o.useMemo(()=>(De?L.filter(m=>m.itemId===De):L).filter(m=>Ut(m.name,V)),[De,L,V]);o.useMemo(()=>{if(j)return j;const l=K.trim().toLowerCase();if(!l||!Re)return null;const m=p.find(P=>P.makerId===Re&&P.name.toLowerCase()===l);return(m==null?void 0:m.id)??null},[j,K,Re,p]);const et=o.useMemo(()=>(Re?p.filter(m=>m.makerId===Re):p).filter(m=>Ut(m.name,K)),[Re,p,K]),tt=l=>{var Ue,Fe,He,$e,qe;const m=l.fields??{},P=m.sealNo??m.qrCode??m.qr??l.qr??"-",te=m.categoryName??((Ue=M.find(Ie=>Ie.id===m.categoryId))==null?void 0:Ue.name)??"-",y=m.subcategoryName??((Fe=E.find(Ie=>Ie.id===m.subcategoryId))==null?void 0:Fe.name)??"-",n=m.itemName??((He=D.find(Ie=>Ie.id===m.itemId))==null?void 0:He.name)??"-",O=m.makerName??(($e=L.find(Ie=>Ie.id===m.makerId))==null?void 0:$e.name)??"-",pe=m.modelName??((qe=p.find(Ie=>Ie.id===m.modelId))==null?void 0:qe.name)??"-",fe=m.width??"-",Be=m.depth??"-",at=m.height??"-";return{qr:P,catName:te,subcatName:y,itemName:n,makerName:O,modelName:pe,width:fe,depth:Be,height:at}},pt=async()=>{if(!X)return;const l=X.fields??{},m={categoryId:l.categoryId,categoryName:l.categoryName,subcategoryId:l.subcategoryId,subcategoryName:l.subcategoryName,itemId:l.itemId,itemName:l.itemName,makerId:l.makerId,makerName:l.makerName,modelId:l.modelId,modelName:l.modelName,width:l.width,depth:l.depth,height:l.height};await s(m),u("/survey/all")},vt=()=>{if(!X)return;const{catName:l,subcatName:m,itemName:P,makerName:te,modelName:y,width:n,depth:O,height:pe}=tt(X),fe=X.fields??{};le(fe.categoryId??null),ne(fe.subcategoryId??null),ie(fe.itemId??null),re(fe.makerId??null),U(fe.modelId??null),b(l==="-"?"":l),q(m==="-"?"":m),F(P==="-"?"":P),G(te==="-"?"":te),oe(y==="-"?"":y),A(n==="-"?"":String(n)),Q(O==="-"?"":String(O)),z(pe==="-"?"":String(pe)),ge(!1),be(!1),ce(!1),W(!1),Y(!1),f(!0)},yt=async()=>{if(!X)return;const l={...X.fields??{},categoryId:ae??void 0,categoryName:B??"",subcategoryId:xe??void 0,subcategoryName:_??"",itemId:Ne??void 0,itemName:g??"",makerId:ve??void 0,makerName:V??"",modelId:j??void 0,modelName:K??"",width:N??"",depth:C??"",height:R??""};await S.survey_drafts.put({...X,fields:l,updatedAt:Date.now()});const m=await a("desc");w(m),f(!1)},st=l=>{b(l),le(null),q(""),ne(null),F(""),ie(null),G(""),re(null),oe(""),U(null)},Nt=l=>{q(l),ne(null),F(""),ie(null),G(""),re(null),oe(""),U(null)},bt=l=>{F(l),ie(null),G(""),re(null),oe(""),U(null)},jt=l=>{G(l),re(null),oe(""),U(null)},wt=l=>{oe(l),U(null)},St=l=>{if(ae===l.id){st("");return}le(l.id),b(l.name),q(""),ne(null),F(""),ie(null),G(""),re(null),oe(""),U(null),ge(!1)},kt=l=>{if(xe===l.id){Nt("");return}const m=M.find(P=>P.id===l.categoryId);b((m==null?void 0:m.name)??""),le(l.categoryId),ne(l.id),q(l.name),F(""),ie(null),G(""),re(null),oe(""),U(null),be(!1)},Ke=l=>{if(Ne===l.id){bt("");return}const m=E.find(te=>te.id===l.subcategoryId),P=M.find(te=>te.id===l.categoryId);b((P==null?void 0:P.name)??""),q((m==null?void 0:m.name)??""),le(l.categoryId),ne(l.subcategoryId),ie(l.id),F(l.name),G(""),re(null),oe(""),U(null),ce(!1)},Ct=l=>{if(ve===l.id){jt("");return}const m=D.find(y=>y.id===l.itemId),P=E.find(y=>y.id===l.subcategoryId),te=M.find(y=>y.id===l.categoryId);b((te==null?void 0:te.name)??""),q((P==null?void 0:P.name)??""),F((m==null?void 0:m.name)??""),le(l.categoryId),ne(l.subcategoryId),ie(l.itemId),re(l.id),G(l.name),oe(""),U(null),W(!1)},ot=l=>{if(j===l.id){wt("");return}const m=L.find(n=>n.id===l.makerId),P=D.find(n=>n.id===l.itemId),te=E.find(n=>n.id===l.subcategoryId),y=M.find(n=>n.id===l.categoryId);b((y==null?void 0:y.name)??""),q((te==null?void 0:te.name)??""),F((P==null?void 0:P.name)??""),G((m==null?void 0:m.name)??""),le(l.categoryId),ne(l.subcategoryId),ie(l.itemId),re(l.makerId),U(l.id),oe(l.name),Y(!1)};return e.jsxs("div",{className:"page",children:[e.jsx("div",{children:e.jsx("div",{className:"history-list",children:k.map(l=>{const m=tt(l),P=l.id===r;return h&&P?e.jsx("div",{className:"history-row is-selected",children:e.jsxs("div",{className:"history-card-grid",children:[e.jsxs("label",{children:["QRコード",e.jsx("input",{value:m.qr,readOnly:!0})]}),e.jsxs("label",{children:["大分類",e.jsx("input",{value:B,onChange:y=>st(y.target.value),onFocus:()=>ge(!0),onBlur:()=>{window.setTimeout(()=>ge(!1),100)},placeholder:"大分類を検索"})]}),we&&he.length>0&&e.jsx("div",{className:"option-list",children:he.map(y=>e.jsx("button",{type:"button",onClick:()=>St(y),className:y.id===ae?"active":"",children:y.name},y.id))}),e.jsxs("label",{children:["中分類",e.jsx("input",{value:_,onChange:y=>Nt(y.target.value),onFocus:()=>be(!0),onBlur:()=>{window.setTimeout(()=>be(!1),100)},placeholder:"中分類を検索"})]}),Me&&_e.length>0&&e.jsx("div",{className:"option-list",children:_e.map(y=>e.jsx("button",{type:"button",onClick:()=>kt(y),className:y.id===xe?"active":"",children:y.name},y.id))}),e.jsxs("label",{children:["品目",e.jsx("input",{value:g,onChange:y=>bt(y.target.value),onFocus:()=>ce(!0),onBlur:()=>{window.setTimeout(()=>ce(!1),100)},placeholder:"品目を検索"})]}),de&&Ge.length>0&&e.jsx("div",{className:"option-list",children:Ge.map(y=>e.jsx("button",{type:"button",onClick:()=>Ke(y),className:y.id===Ne?"active":"",children:y.name},y.id))}),e.jsxs("label",{children:["メーカー名",e.jsx("input",{value:V,onChange:y=>jt(y.target.value),onFocus:()=>W(!0),onBlur:()=>{window.setTimeout(()=>W(!1),100)},placeholder:"メーカーを検索"})]}),d&&gt.length>0&&e.jsx("div",{className:"option-list",children:gt.map(y=>e.jsx("button",{type:"button",onClick:()=>Ct(y),className:y.id===ve?"active":"",children:y.name},y.id))}),e.jsxs("label",{children:["型式",e.jsx("input",{value:K,onChange:y=>wt(y.target.value),onFocus:()=>Y(!0),onBlur:()=>{window.setTimeout(()=>Y(!1),100)},placeholder:"型式を検索"})]}),ee&&et.length>0&&e.jsx("div",{className:"option-list",children:et.map(y=>e.jsx("button",{type:"button",onClick:()=>ot(y),className:y.id===j?"active":"",children:y.name},y.id))}),e.jsxs("label",{children:["W",e.jsx("input",{value:N,onChange:y=>A(y.target.value)})]}),e.jsxs("label",{children:["D",e.jsx("input",{value:C,onChange:y=>Q(y.target.value)})]}),e.jsxs("label",{children:["H",e.jsx("input",{value:R,onChange:y=>z(y.target.value)})]})]})},l.id):e.jsx("button",{type:"button",className:`history-row${P?" is-selected":""}`,onClick:()=>c(l.id),children:e.jsxs("div",{className:"history-card-grid",children:[e.jsxs("label",{children:["QRコード",e.jsx("div",{className:"history-value",children:m.qr})]}),e.jsxs("label",{children:["大分類",e.jsx("div",{className:"history-value",children:m.catName})]}),e.jsxs("label",{children:["中分類",e.jsx("div",{className:"history-value",children:m.subcatName})]}),e.jsxs("label",{children:["品目",e.jsx("div",{className:"history-value",children:m.itemName})]}),e.jsxs("label",{children:["メーカー名",e.jsx("div",{className:"history-value",children:m.makerName})]}),e.jsxs("label",{children:["型式",e.jsx("div",{className:"history-value",children:m.modelName})]}),e.jsxs("label",{children:["W",e.jsx("div",{className:"history-value",children:m.width})]}),e.jsxs("label",{children:["D",e.jsx("div",{className:"history-value",children:m.depth})]}),e.jsxs("label",{children:["H",e.jsx("div",{className:"history-value",children:m.height})]})]})},l.id)})})}),e.jsx("footer",{className:"page-footer",children:h?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>f(!1),children:"キャンセル"}),e.jsx("button",{type:"button",onClick:yt,children:"保存"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>u(-1),children:"戻る"}),e.jsx("button",{type:"button",className:"ghost",onClick:vt,disabled:!X,children:"修正"}),e.jsx("button",{type:"button",onClick:pt,disabled:!X,children:"再利用"})]})})]})}export{ba as A,ya as D,Aa as H,Ia as L,ja as P,Fa as S,Ea as a,Oa as b,_a as c,S as d,ts as e,Da as f,Ra as g,po as p,Ma as q,ft as u,fa as w};
